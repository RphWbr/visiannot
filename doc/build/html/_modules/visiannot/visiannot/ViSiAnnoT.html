

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>visiannot.visiannot.ViSiAnnoT &mdash; ViSiAnnoT 0.2.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> ViSiAnnoT
          

          
          </a>

          
            
            
              <div class="version">
                0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../userguide-visiannot.html">User guide: ViSiAnnoT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../userguide-configuration.html">User guide: configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../userguide-toolspyqt.html">User guide: ToolsPyQt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../userguide-toolspyqtgraph.html">User guide: ToolsPyqtgraph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../exe.html">Creating a standalone executable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software.html">Software description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../further.html">Further developments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../APIreference/index.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ViSiAnnoT</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>visiannot.visiannot.ViSiAnnoT</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for visiannot.visiannot.ViSiAnnoT</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#</span>
<span class="c1"># Copyright Universit√© Rennes 1</span>
<span class="c1"># Contributor: Raphael Weber</span>
<span class="c1">#</span>
<span class="c1"># Under CeCILL license</span>
<span class="c1"># http://www.cecill.info</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module defining :class:`.ViSiAnnoT`</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="k">import</span> <span class="n">QtWidgets</span><span class="p">,</span> <span class="n">QtCore</span>
<span class="kn">import</span> <span class="nn">pyqtgraph</span> <span class="k">as</span> <span class="nn">pg</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="k">import</span> <span class="n">Thread</span>
<span class="kn">from</span> <span class="nn">cv2</span> <span class="k">import</span> <span class="n">imwrite</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="k">import</span> <span class="n">time</span><span class="p">,</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="k">import</span> <span class="n">rmtree</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">ceil</span>
<span class="kn">from</span> <span class="nn">pytz</span> <span class="k">import</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">..tools</span> <span class="k">import</span> <span class="n">ToolsPyQt</span>
<span class="kn">from</span> <span class="nn">..tools</span> <span class="k">import</span> <span class="n">ToolsPyqtgraph</span>
<span class="kn">from</span> <span class="nn">..tools</span> <span class="k">import</span> <span class="n">ToolsDateTime</span>
<span class="kn">from</span> <span class="nn">..tools</span> <span class="k">import</span> <span class="n">ToolsData</span>
<span class="kn">from</span> <span class="nn">..tools</span> <span class="k">import</span> <span class="n">ToolsImage</span>
<span class="kn">from</span> <span class="nn">..tools</span> <span class="k">import</span> <span class="n">ToolsAudio</span>
<span class="kn">from</span> <span class="nn">.components.Signal</span> <span class="k">import</span> <span class="n">Signal</span>
<span class="kn">from</span> <span class="nn">.components.MenuBar</span> <span class="k">import</span> <span class="n">MenuBar</span>


<div class="viewcode-block" id="ViSiAnnoT"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT">[docs]</a><span class="k">class</span> <span class="nc">ViSiAnnoT</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">video_dict</span><span class="p">,</span>
        <span class="n">signal_dict</span><span class="p">,</span>
        <span class="n">annotevent_dict</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">annotimage_list</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">threshold_dict</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">interval_dict</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">y_range_dict</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">poswid_dict</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">layout_mode</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">trunc_duration</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">flag_long_rec</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">from_cursor_list</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">zoom_factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">nb_ticks</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">annot_dir_base</span><span class="o">=</span><span class="s2">&quot;Annotations&quot;</span><span class="p">,</span>
        <span class="n">down_freq</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">flag_pause_status</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">max_points</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">time_zone</span><span class="o">=</span><span class="s2">&quot;Europe/Paris&quot;</span><span class="p">,</span>
        <span class="n">flag_infinite_loop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">bg_color</span><span class="o">=</span><span class="p">(</span><span class="mi">244</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">244</span><span class="p">),</span>
        <span class="n">bg_color_plot</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
        <span class="n">font_name</span><span class="o">=</span><span class="s2">&quot;Times&quot;</span><span class="p">,</span>
        <span class="n">font_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">font_size_title</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">font_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">ticks_color</span><span class="o">=</span><span class="p">(</span><span class="mi">93</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">89</span><span class="p">),</span>
        <span class="n">ticks_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">ticks_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">nb_table_annot</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">height_widget_signal</span><span class="o">=</span><span class="mi">150</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class defining the visualization and annotation GUI for a set of</span>
<span class="sd">        synchronized video(s) and signal(s).</span>

<span class="sd">        The constructor takes as arguments dictionaries with the path to the</span>
<span class="sd">        video files and signal files. It calls the method</span>
<span class="sd">        :meth:`.setAllData` in order to load data and store them in</span>
<span class="sd">        attributes.</span>

<span class="sd">        For a given video file, data are loaded in an instance of</span>
<span class="sd">        cv2.VideoCapture. The set of video data is stored in</span>
<span class="sd">        :attr:`.video_data_dict`. The set of widgets for plotting</span>
<span class="sd">        video is stored in :attr:`.wid_vid_dict`. The set of current</span>
<span class="sd">        video frames is stored in :attr:`.im_dict`. For plotting, the</span>
<span class="sd">        video frames are converted to instances of pyqtgraph.ImageItem which</span>
<span class="sd">        are stored in :attr:`.img_vid_dict`.</span>

<span class="sd">        For a given signal file, data are loaded in an instance of</span>
<span class="sd">        :class:`.Signal`. The supported formats are txt, mat, h5 and wav. The</span>
<span class="sd">        set of :class:`.Signal` instances is stored in</span>
<span class="sd">        :attr:`.sig_list_list`. The set of widgets for plotting</span>
<span class="sd">        signals is stored in :attr:`.wid_data_list`. A temporal</span>
<span class="sd">        cursor (instance of pyqtgraph.InfiniteLine) is plotted on each signal</span>
<span class="sd">        widget and is synchronized with the video playback. The set of temporal</span>
<span class="sd">        cursors is stored in :attr:`.current_cursor_list`.</span>

<span class="sd">        The reference frequency :attr:`.ViSiAnnoT.fps` is defined as the video</span>
<span class="sd">        frequency. If there is no video to display, :attr:`.ViSiAnnoT.fps` is</span>
<span class="sd">        defined as the frequency of the first signal to plot. The playback</span>
<span class="sd">        speed (both video and signal temporal cursor) is at the reference</span>
<span class="sd">        frequency.</span>

<span class="sd">        The video display is initialized by the method</span>
<span class="sd">        :meth:`.initVideoPlot`. The signal display is initialized by</span>
<span class="sd">        the method :meth:`.initSignalPlot`.</span>

<span class="sd">        The temporal range is defined by :attr:`.first_frame` and</span>
<span class="sd">        :attr:`.last_frame` (sampled at :attr:`.ViSiAnnoT.fps`).</span>
<span class="sd">        The signal widgets display the signal between those bounds. So when</span>
<span class="sd">        zooming in/out, the temporal range is modified and then the display is</span>
<span class="sd">        updated with the method :meth:`.updateSignalPlot`.</span>

<span class="sd">        The playback is managed with two separate threads:</span>

<span class="sd">        - Reading next video frame - an instance of threading.Thread with the</span>
<span class="sd">          method :meth:`.updateVideoFrame` as target,</span>
<span class="sd">        - Updating plot - an instance of QtCore.QTimer connected to the method</span>
<span class="sd">          :meth:`.updatePlot`.</span>

<span class="sd">        The current position in the video file (i.e. the current position of</span>
<span class="sd">        the temporal cursor) is :attr:`.frame_id` (sampled at</span>
<span class="sd">        :attr:`.ViSiAnnoT.fps`).</span>

<span class="sd">        :param video_dict: video configuration, each item corresponds to one</span>
<span class="sd">            camera. Key is the camera ID (string). Value is a configuration</span>
<span class="sd">            list with 4 elements:</span>

<span class="sd">            - (*str*) Path to the video file,</span>
<span class="sd">            - (*str*) Delimiter to get beginning datetime in the video file</span>
<span class="sd">              name,</span>
<span class="sd">            - (*int*) Position of the beginning datetime in the video file</span>
<span class="sd">              name, according to the delimiter,</span>
<span class="sd">            - (*str*) Format of the beginning datetime in the video file name</span>
<span class="sd">              (either ``&quot;posix&quot;`` or a format compliant with</span>
<span class="sd">              ``datetime.strptime()``).</span>
<span class="sd">        :type video_dict: dict</span>
<span class="sd">        :param signal_dict: signal configuration, each item corresponds to one</span>
<span class="sd">            signal widget. Key is the widget ID (Y axis label, string). Value</span>
<span class="sd">            is a nested list of signal configurations. Each element of the</span>
<span class="sd">            nested list corresponds to one signal plot and is a configuration</span>
<span class="sd">            list of 7 elements:</span>

<span class="sd">            - (*str*) Path to the signal file, data must be stored in a 1D</span>
<span class="sd">              array if regularly sampled, otherwise in a 2D array (where first</span>
<span class="sd">              column is the timestamp in milliseconds and the second column the</span>
<span class="sd">              signal value)</span>
<span class="sd">            - (*str*) Key to access the data (in case of .mat or .h5 file),</span>
<span class="sd">            - (*int* or *float* or *str*) Signal frequency, set it to ``0`` if</span>
<span class="sd">              signal non regularly sampled, set it to ``-1`` if same frequency</span>
<span class="sd">              as :attr:`.ViSiAnnoT.fps`, it may be a string with the path to</span>
<span class="sd">              the frequency attribute in a .h5 file,</span>
<span class="sd">            - (*str*) Delimiter to get beginning datetime in the signal file</span>
<span class="sd">              name,</span>
<span class="sd">            - (*int*) Position of the beginning datetime in the signal file</span>
<span class="sd">              name, according to the delimiter,</span>
<span class="sd">            - (*str*) Format of the beginning datetime in the signal file name</span>
<span class="sd">              (either ``&quot;posix&quot;`` or a format compliant with</span>
<span class="sd">              ``datetime.strptime()``),</span>
<span class="sd">            - (*dict*) Plot style, see</span>
<span class="sd">              https://pyqtgraph.readthedocs.io/en/latest/graphicsItems/plotdataitem.html</span>
<span class="sd">              for details, set it to ``None`` for default.</span>

<span class="sd">            Here is an example::</span>

<span class="sd">                {</span>
<span class="sd">                &quot;sig_1&quot;: [</span>
<span class="sd">                    [</span>
<span class="sd">                        &quot;folder1/file1.txt&quot;, &quot;&quot;, 50, &#39;_&#39;, 1,</span>
<span class="sd">                        &quot;%Y-%m-%dT%H-%M-%S&quot;, None</span>
<span class="sd">                    ]</span>
<span class="sd">                ],</span>
<span class="sd">                &quot;sig_2&quot;: [</span>
<span class="sd">                    [</span>
<span class="sd">                        &quot;folder1/file2.h5&quot;, &quot;key2&quot;, 0, &#39;_&#39;, 0, &quot;posix&quot;,</span>
<span class="sd">                        {&#39;pen&#39;: {&#39;color&#39;: &#39;m&#39;, &#39;width&#39;: 1}</span>
<span class="sd">                    ],</span>
<span class="sd">                    [&quot;folder3/file3.mat&quot;, &quot;key3&quot;, -1, &#39;_&#39;, 0, &quot;posix&quot;, None]</span>
<span class="sd">                ]</span>
<span class="sd">                }</span>

<span class="sd">            In case of audio signal to plot, the configuration list is slightly</span>
<span class="sd">            different. The second element (key to access data) is a string to</span>
<span class="sd">            specify which channel to plot. It must contain ``&quot;left&quot;`` or</span>
<span class="sd">            ``&quot;right&quot;``, whatever the letter capitalization is. Otherwise, by</span>
<span class="sd">            default the left channel is plotted. Moreover, the frequency is</span>
<span class="sd">            directly retrieved from the wav file, so the third element of the</span>
<span class="sd">            configuration list (signal frequency) is ignored.</span>

<span class="sd">            Here is an example for audio::</span>

<span class="sd">                {</span>
<span class="sd">                &quot;Audio L&quot;: [</span>
<span class="sd">                    [</span>
<span class="sd">                        &quot;path/to/audio.wav&quot;, &quot;Left channel&quot;, 0, &#39;_&#39;, 1,</span>
<span class="sd">                        &quot;%Y-%m-%dT%H-%M-%S&quot;, None</span>
<span class="sd">                    ]</span>
<span class="sd">                ],</span>
<span class="sd">                &quot;Audio R&quot;: [</span>
<span class="sd">                    [</span>
<span class="sd">                        &quot;path/to/audio.wav&quot;, &quot;Right channel&quot;, 0, &#39;_&#39;, 1,</span>
<span class="sd">                        &quot;%Y-%m-%dT%H-%M-%S&quot;, None</span>
<span class="sd">                    ]</span>
<span class="sd">                ]</span>
<span class="sd">                }</span>
<span class="sd">        :type signal_dict: dict</span>
<span class="sd">        :param annotevent_dict: events annotation configuration.</span>
<span class="sd">            Key is the label (string). Value is the associated color (RGBA).</span>
<span class="sd">        :type annotevent_dict: dict</span>
<span class="sd">        :param annotimage_list: labels for image extraction</span>
<span class="sd">        :type annotimage_list: list</span>
<span class="sd">        :param threshold_dict: threshold configuration. Each item corresponds</span>
<span class="sd">            to a signal widget on which to plot threshold(s). The key must be</span>
<span class="sd">            the same as in ``signal_dict``. Value is a list of configuration</span>
<span class="sd">            lists. This is a nested list because there can be several</span>
<span class="sd">            thresholds plotted in the same widget. A configuration list has 2</span>
<span class="sd">            elements:</span>

<span class="sd">            - (*int* or *float*) Threshold value on Y axis,</span>
<span class="sd">            - (*tuple* or *list* or *str*) Plot color in (RGB) format or HEX</span>
<span class="sd">              color string.</span>
<span class="sd">        :type threshold_dict: dict</span>
<span class="sd">        :param interval_dict: interval configuration. Each item corresponds to</span>
<span class="sd">            a signal widget on which to plot intervals. The key must be the</span>
<span class="sd">            same as in ``signal_dict``. Value is a nested list of interval</span>
<span class="sd">            configurations. Each element of the nested list corresponds to one</span>
<span class="sd">            type of interval to be plotted on the same signal widget and is a</span>
<span class="sd">            configuration list of 7 elements:</span>

<span class="sd">            - (*str*) Path to the interval file, data can be stored as a 2D</span>
<span class="sd">              array (where each line has 2 elements: start and stop frames) or</span>
<span class="sd">              a 1D array (time series of 0 and 1),</span>
<span class="sd">            - (*str*) Key to access the data (in case of .mat or .h5 file),</span>
<span class="sd">            - (*int*) Signal frequency, set it to ``-1`` if same frequency as</span>
<span class="sd">              :attr:`.ViSiAnnoT.fps`, it may be a string with the path to the</span>
<span class="sd">              frequency attribute in a .h5 file,</span>
<span class="sd">            - (*str*) Delimiter to get beginning datetime in the interval file</span>
<span class="sd">              name,</span>
<span class="sd">            - (*int*) Position of the beginning datetime in the interval file</span>
<span class="sd">              name, according to the delimiter,</span>
<span class="sd">            - (*str*) Format of the beginning datetime in the interval file</span>
<span class="sd">              name (either ``&quot;posix&quot;`` or a format compliant with</span>
<span class="sd">              ``datetime.strptime()``),</span>
<span class="sd">            - (*tuple* or *list*) Plot color (RGBA).</span>
<span class="sd">        :type interval_dict: dict</span>
<span class="sd">        :param y_range_dict: visible Y range for signal widgets, each item</span>
<span class="sd">            corresponds to a signal widget. The key must be the same as in</span>
<span class="sd">            ``signal_dict``. Value is a list/tuple of length 2 with the min and</span>
<span class="sd">            max values to display on the Y axis. The signal widgets that are</span>
<span class="sd">            not specified in this dictionary have auto-range enabled for Y</span>
<span class="sd">            axis.</span>
<span class="sd">        :type y_range_dict: dict</span>
<span class="sd">        :param poswid_dict: custom position of the widgets in the window to use</span>
<span class="sd">            the positions defined by the layout mode (see input</span>
<span class="sd">            ``layout_mode``). Value is a tuple of length 2 ``(row, col)``</span>
<span class="sd">            or 4 ``(row, col, rowspan, colspan)``. Key identifies the widget:</span>

<span class="sd">            - ``&quot;logo&quot;``</span>
<span class="sd">            - ``&quot;select_trunc&quot;``</span>
<span class="sd">            - ``&quot;select_manual&quot;``</span>
<span class="sd">            - ``&quot;select_from_cursor&quot;``</span>
<span class="sd">            - ``&quot;annot_event&quot;``</span>
<span class="sd">            - ``&quot;annot_image&quot;``</span>
<span class="sd">            - ``&quot;visi&quot;``</span>
<span class="sd">            - ``&quot;zoomin&quot;``</span>
<span class="sd">            - ``&quot;zoomout&quot;``</span>
<span class="sd">            - ``&quot;progress&quot;``</span>
<span class="sd">        :type poswid_dict: dict</span>
<span class="sd">        :param layout_mode: layout mode of the window for positioning the</span>
<span class="sd">            widgets, one of the following:</span>

<span class="sd">            - ``1`` (focus on video, works better with a big screen),</span>
<span class="sd">            - ``2`` (focus on signal, suitable for a laptop screen),</span>
<span class="sd">            - ``3`` (compact display with some features disabled).</span>
<span class="sd">        :type layout_mode: int</span>
<span class="sd">        :param trunc_duration: (tool for fast navigation) duration</span>
<span class="sd">            ``(min, sec)`` to be used for splitting video/file in the combo box</span>
<span class="sd">            of temporal range selection. For example, for a video of 30</span>
<span class="sd">            minutes, ``trunc_duration=(10, 0)`` will provide 3 temporal ranges</span>
<span class="sd">            in the combo box: from 0 to 10 minutes, from 10 to 20 minutes and</span>
<span class="sd">            from 20 to 30 minutes.</span>
<span class="sd">        :type trunc_duration: list</span>
<span class="sd">        :param flag_long_rec: specify if :class:`.ViSiAnnoT` is launched in the</span>
<span class="sd">            context of :class:`.ViSiAnnoTLongRec` (long recording)</span>
<span class="sd">        :type flag_long_rec: bool</span>
<span class="sd">        :param from_cursor_list: (tool for fast navigation) list of durations</span>
<span class="sd">            that are available in the combo box to select a temporal range</span>
<span class="sd">            duration in order to display a new temporal range that will begin</span>
<span class="sd">            at the current position of the temporal cursor. Each element is a</span>
<span class="sd">            tuple of length 2 ``(min, sec)``. An example:</span>
<span class="sd">            ``[[0,30],[1,0],[2,0],[3,0],[4,0],[5,0]]``.</span>
<span class="sd">        :type from_cursor_list: list</span>
<span class="sd">        :param zoom_factor: zoom factor</span>
<span class="sd">        :type zoom_factor: int</span>
<span class="sd">        :param nb_ticks: number of temporal ticks on the X axis of the signals</span>
<span class="sd">            widgets</span>
<span class="sd">        :type nb_ticks: int</span>
<span class="sd">        :param annot_dir_base: base directory where to save annotations, a</span>
<span class="sd">            sub-directory is automatically created for the recording</span>
<span class="sd">        :type annot_dir_base: str</span>
<span class="sd">        :param down_freq: maximum signal frequency to plot, if a signal has a</span>
<span class="sd">            frequency strictly higher than ``down_freq``, then the signal is</span>
<span class="sd">            downsampled to ``down_freq``</span>
<span class="sd">        :type down_freq: int</span>
<span class="sd">        :param flag_pause_status: specify if the video is paused when launching</span>
<span class="sd">            :class:`.ViSiAnnoT`</span>
<span class="sd">        :type flag_pause_status: bool</span>
<span class="sd">        :param max_points: maximum number of points to plot for the signals</span>
<span class="sd">        :type max_points: int</span>
<span class="sd">        :param time_zone: time zone (compliant package pytz)</span>
<span class="sd">        :type time_zone: str</span>
<span class="sd">        :param flag_infinite_loop: specify if an infinite loop is set after</span>
<span class="sd">            creating the window. Set it to ``False`` if several</span>
<span class="sd">            :class:`.ViSiAnnoT` windows must be displayed simultaneousely, do</span>
<span class="sd">            not forget to store each instance of :class:`.ViSiAnnoT` in a</span>
<span class="sd">            variable and to set manually the infinite loop with</span>
<span class="sd">            :func:`graphicsoverlayer.ToolsPyQt.infiniteLoopDisplay`</span>
<span class="sd">        :type flag_infinite_loop: bool</span>
<span class="sd">        :param bg_color: backgroud color of the GUI, RGB or HEX string</span>
<span class="sd">        :type bg_color: tuple or str</span>
<span class="sd">        :param bg_color_plot: background color of the signal plots, RGB or HEX</span>
<span class="sd">            string</span>
<span class="sd">        :type bg_color_plot: tuple or str</span>
<span class="sd">        :param font_name: font used for the text in the GUI (must be available</span>
<span class="sd">            in PyQt5)</span>
<span class="sd">        :type font_name: str</span>
<span class="sd">        :param font_size: font size of the text in the GUI</span>
<span class="sd">        :type font_size: int</span>
<span class="sd">        :param font_size_title: font size of the titles in the GUI (progress</span>
<span class="sd">            bar and video widgets)</span>
<span class="sd">        :type font_size_title: int</span>
<span class="sd">        :param font_color: font color of the text in the GUI, RGB</span>
<span class="sd">        :type font_color: tuple</span>
<span class="sd">        :param ticks_color: color of the ticks in the signal plots, RGB or HEX</span>
<span class="sd">            string</span>
<span class="sd">        :type ticks_color: tuple or str</span>
<span class="sd">        :param ticks_size: size of the ticks values in the signal plots</span>
<span class="sd">        :type ticks_size: int</span>
<span class="sd">        :param ticks_offset: offset between the ticks and associated values in</span>
<span class="sd">            the signal plots</span>
<span class="sd">        :type ticks_offset: int</span>
<span class="sd">        :param nb_table_annot: maximum number of labels in a row in the</span>
<span class="sd">            widgets for event annotation and image annotation</span>
<span class="sd">        :type nb_table_annot: int</span>
<span class="sd">        :param height_widget_signal: minimum height in pixel of the signal</span>
<span class="sd">            widgets</span>
<span class="sd">        :type height_widget_signal: int</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check input dictionaries are empty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">video_dict</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">signal_dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Input dictionaries are empty&quot;</span><span class="p">)</span>

        <span class="c1"># ******************************************************************* #</span>
        <span class="c1"># *********************** miscellaneous ***************************** #</span>
        <span class="c1"># ******************************************************************* #</span>
        <span class="c1">#: (*int*) Number of temporal ticks on the X axis of the</span>
        <span class="c1">#: signals plots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_ticks</span> <span class="o">=</span> <span class="n">nb_ticks</span>

        <span class="c1">#: (*str*) Time zone (as in package pytz)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_zone</span> <span class="o">=</span> <span class="n">time_zone</span>

        <span class="c1">#: (*int*) Maximum signal frequency to plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down_freq</span> <span class="o">=</span> <span class="n">down_freq</span>

        <span class="c1">#: (*int*) Maximum number of points to plot for the signals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_points</span> <span class="o">=</span> <span class="n">max_points</span>

        <span class="c1">#: (*list*) Default plot styles for signals on a single widget</span>
        <span class="c1">#: (length 10)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_style_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;pen&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
            <span class="p">{</span><span class="s1">&#39;pen&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
            <span class="p">{</span><span class="s1">&#39;pen&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
            <span class="p">{</span><span class="s1">&#39;pen&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
            <span class="p">{</span><span class="s1">&#39;pen&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
            <span class="p">{</span><span class="s1">&#39;pen&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
            <span class="p">{</span><span class="s1">&#39;pen&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
            <span class="p">{</span><span class="s1">&#39;pen&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#FFCCFF&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
            <span class="p">{</span><span class="s1">&#39;pen&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#00CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
            <span class="p">{</span><span class="s1">&#39;pen&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#4C9900&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
        <span class="p">]</span>

        <span class="c1">#: (*list*) Data types (string) for signal widget</span>
        <span class="c1">#:</span>
        <span class="c1">#: It is the list of keys of ``signal_dict``</span>
        <span class="c1">#: (positional argument of the constructor of :class:`.ViSiAnnoT`),</span>
        <span class="c1">#:</span>
        <span class="c1">#: It is used for the Y axis label of the signal widgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sig_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">signal_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>



        <span class="c1"># ******************************************************************* #</span>
        <span class="c1"># ************************ long recordings ************************** #</span>
        <span class="c1"># ******************************************************************* #</span>
        <span class="c1">#: (*bool*) Specify if :class:`.ViSiAnnoT` is launched in the context</span>
        <span class="c1">#: of :class:`.ViSiAnnoTLongRec`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_long_rec</span> <span class="o">=</span> <span class="n">flag_long_rec</span>

        <span class="c1">#: (*int*) ID of the current video/signal file in case of long</span>
        <span class="c1">#: recordings</span>
        <span class="c1">#:</span>
        <span class="c1">#: If :attr:`.ViSiAnnoT.flag_long_rec` is ``False``, then</span>
        <span class="c1">#: :attr:`.ViSiAnnoT.rec_id` is always equal to 0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec_id</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#: (*int*) Number of files in case of long recordings</span>
        <span class="c1">#:</span>
        <span class="c1">#: If ``self.flag_long_rec`` is false, then ``self.rec_nb`` is set to</span>
        <span class="c1">#: 1.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec_nb</span> <span class="o">=</span> <span class="mi">1</span>


        <span class="c1"># ******************************************************************* #</span>
        <span class="c1"># *************************** data ********************************** #</span>
        <span class="c1"># ******************************************************************* #</span>

        <span class="c1"># initialize attributes that are set in the method setAllData</span>

        <span class="c1">#: (*dict*) Key is the camera ID, value is an instance of</span>
        <span class="c1">#: cv2.VideoCapture containing the video data</span>
        <span class="c1">#:</span>
        <span class="c1">#: Same keys as ``video_dict``, positional argument of the constructor</span>
        <span class="c1">#: of :class:`.ViSiAnnoT`.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video_data_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="c1"># only for documentation</span>
        <span class="c1">#: (*list*) Each element corresponds to a signal widget and is a list</span>
        <span class="c1">#: of instances of :class:`.Signal` to plot on the corresponding widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sig_list_list</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (*dict*) Intervals to plot on signals, each item corresponds to one</span>
        <span class="c1">#: signal widget</span>
        <span class="c1">#:</span>
        <span class="c1">#: Key is the data type of the signal widget on which to plot (same as</span>
        <span class="c1">#: in positional argument ``signal_dict`` of the constructor of</span>
        <span class="c1">#: :class:`.ViSiAnnoT`)</span>
        <span class="c1">#:</span>
        <span class="c1">#: Value is a list of lists, so that several intervals files can be</span>
        <span class="c1">#: plotted on the same signal widget. Each sub-list has 3 elements:</span>
        <span class="c1">#:</span>
        <span class="c1">#:  - (*numpy array*) Intervals data, shape :math:`(n_{detection}, 2)`</span>
        <span class="c1">#:  - (*float*) Frequency (``0`` if timestamps, ``-1`` if same as</span>
        <span class="c1">#:    signal)</span>
        <span class="c1">#:  - (*tuple*) Plot color (RGBA)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># for documentation only</span>
        <span class="c1">#: (*int*) Frequency of the video (or the first signal if there is no</span>
        <span class="c1">#: video), it is the reference frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># for documentation only</span>
        <span class="c1">#: (*int*) Number of frames in the video (or the first signal if there</span>
        <span class="c1">#: is no video)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># for documentation only</span>
        <span class="c1">#: (*datetime.datetime*) Beginning datetime of the video (or the first</span>
        <span class="c1">#: signal if there is no video)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># set data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAllData</span><span class="p">(</span><span class="n">video_dict</span><span class="p">,</span> <span class="n">signal_dict</span><span class="p">,</span> <span class="n">interval_dict</span><span class="p">)</span>

        <span class="c1">#: (*dict*) Thresholds to plot on signals widgets</span>
        <span class="c1">#:</span>
        <span class="c1">#: For a given signal, key must be the corresponding element in</span>
        <span class="c1">#: :attr:`.ViSiAnnoT.sig_labels`</span>
        <span class="c1">#:</span>
        <span class="c1">#: Value is a list of length 2:</span>
        <span class="c1">#:</span>
        <span class="c1">#: - integer/float with the value of the threshold (on Y axis)</span>
        <span class="c1">#: - tuple with the color to plot (RGB), it can also be a</span>
        <span class="c1">#:   string with HEX color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold_dict</span> <span class="o">=</span> <span class="n">threshold_dict</span>


        <span class="c1"># ******************************************************************* #</span>
        <span class="c1"># ******************** decorative images **************************** #</span>
        <span class="c1"># ******************************************************************* #</span>
        <span class="n">dir_path</span> <span class="o">=</span> <span class="n">ToolsData</span><span class="o">.</span><span class="n">getWorkingDirectory</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>

        <span class="n">im_deco_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">im_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;zoomin&quot;</span><span class="p">,</span> <span class="s2">&quot;zoomout&quot;</span><span class="p">,</span> <span class="s2">&quot;visibility&quot;</span><span class="p">]:</span>
            <span class="n">im_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/Images/</span><span class="si">%s</span><span class="s2">.jpg&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">im_name</span><span class="p">)</span>
            <span class="n">im_deco_dict</span><span class="p">[</span><span class="n">im_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ToolsImage</span><span class="o">.</span><span class="n">readImage</span><span class="p">(</span><span class="n">im_path</span><span class="p">)</span>


        <span class="c1"># ******************************************************************* #</span>
        <span class="c1"># ***************** annotation files management ********************* #</span>
        <span class="c1"># ******************************************************************* #</span>

        <span class="c1"># check if not long recording</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_long_rec</span><span class="p">:</span>
            <span class="c1"># check if any video</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">video_dict</span><span class="p">):</span>
                <span class="c1">#: (*str*) Base name of the annotation files</span>
                <span class="c1">#:</span>
                <span class="c1">#: Label and annotation type is added when loading/saving</span>
                <span class="c1">#: annotation files)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annot_file_base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">video_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># get base name of annotation files</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annot_file_base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">signal_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1">#: (*str*) Directory where the annotations are saved</span>
        <span class="c1">#:</span>
        <span class="c1">#: A sub-directory is automatically created: %s_annotations, where %s</span>
        <span class="c1">#: is the name of the first video file (or signal file if no video).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annot_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">_annotations&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">annot_dir_base</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">annot_file_base</span>
        <span class="p">)</span>


        <span class="c1"># ******************************************************************* #</span>
        <span class="c1"># ********************** event annotation *************************** #</span>
        <span class="c1"># ******************************************************************* #</span>

        <span class="c1">#: (*str*) Label automatically created for getting duration of video</span>
        <span class="c1">#: files (or first signal if no video)</span>
        <span class="c1">#:</span>
        <span class="c1">#: It cannot be used for manual annotation, so it is ignored if</span>
        <span class="c1">#: specified by the user in the keyword argument ``annotevent_dict`` of</span>
        <span class="c1">#: :class:`.ViSiAnnoT` constructor.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_protected_label</span> <span class="o">=</span> <span class="s2">&quot;DURATION&quot;</span>

        <span class="c1"># check if protected label in list of labels</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_protected_label</span> <span class="ow">in</span> <span class="n">annotevent_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">del</span> <span class="n">annotevent_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_protected_label</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Label </span><span class="si">%s</span><span class="s2"> for events annotation is protected and cannot be</span><span class="se">\</span>
<span class="s2">                used for manual annotation, so it is ignored&quot;</span> <span class="o">%</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_protected_label</span>
            <span class="p">)</span>

        <span class="c1">#: (*list*) Labels of the event annotation (string)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_label_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">annotevent_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1">#: (*list*) Colors of the event annotation labels</span>
        <span class="c1">#:</span>
        <span class="c1">#: each element is a list of length 4 with the RGBA color, or length 3</span>
        <span class="c1">#: with the RGB color (in this case transparency A is set to 100)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_color_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">annotevent_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="c1"># add transparency for color if needed</span>
        <span class="k">for</span> <span class="n">annot_color</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_color_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">annot_color</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">annot_color</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">annot_color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>

        <span class="c1">#: (*numpy array*) Array with unsaved annotated events</span>
        <span class="c1">#:</span>
        <span class="c1">#: Shape :math:`(n_{annot}, 2, 2)`, where :math:`n_{annot}` is the</span>
        <span class="c1">#: length of :attr:`.ViSiAnnoT.annotevent_label_list`.</span>
        <span class="c1">#: For a given label with index ``n`` in</span>
        <span class="c1">#: :attr:`.ViSiAnnoT.annotevent_label_list`, the sub-array</span>
        <span class="c1">#: ``self.annotevent_array[n]`` is organized as follows:</span>
        <span class="c1">#:</span>
        <span class="c1">#: =====================  =================================================</span>
        <span class="c1">#: start datetime string  start frame index in the format &quot;rec-id_frame-id&quot;</span>
        <span class="c1">#: end datetime string    end frame index in the format &quot;rec-id_frame-id&quot;</span>
        <span class="c1">#: =====================  =================================================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_label_list</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span>
        <span class="p">)</span>

        <span class="c1">#: (*dict*) Event annotations descriptions to be displayed</span>
        <span class="c1">#:</span>
        <span class="c1">#: Key is the index of a label in</span>
        <span class="c1">#: :attr:`.ViSiAnnoT.annotevent_label_list`. Value is a dictionary:</span>
        <span class="c1">#:</span>
        <span class="c1">#:      - Key is an integer with the annotation ID (index in the</span>
        <span class="c1">#:        annotation file)</span>
        <span class="c1">#:      - Value is a list of instances of pyqtgraph.TextItem with the</span>
        <span class="c1">#:        description, same length and order as</span>
        <span class="c1">#:        :attr:`.ViSiAnnoT.wid_data_list`, so that one element</span>
        <span class="c1">#:        corresponds to one signal widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_description_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1">#: (*list*) Way of storing event annotations</span>
        <span class="c1">#:</span>
        <span class="c1">#: Two elements:</span>
        <span class="c1">#:</span>
        <span class="c1">#: - ``&quot;datetime&quot;``: datetime string in the format</span>
        <span class="c1">#:   %Y-%M-%DT%h-%m-%s.%ms</span>
        <span class="c1">#: - ``&quot;frame&quot;``: rec-id_frame-id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_type_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="s2">&quot;frame&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_label_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#: (*list*) Files names of event annotation</span>
            <span class="c1">#:</span>
            <span class="c1">#: Same length as :attr:`.ViSiAnnoT.annotevent_type_list`, there is</span>
            <span class="c1">#: one file for each annotation type.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_path_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotEventGetPathList</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_label_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># create directory if necessary</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_dir</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_dir</span><span class="p">)</span>

            <span class="c1"># create annotation file with duration of video files</span>
            <span class="c1"># (or first signal if no video)</span>
            <span class="n">output_path_0</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">-datetime.txt&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">annot_file_base</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_protected_label</span><span class="p">)</span>
            <span class="n">output_path_1</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">-frame.txt&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">annot_file_base</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_protected_label</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">output_path_0</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_long_rec</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path_0</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">beg_datetime</span><span class="p">,</span> <span class="n">duration</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rec_beginning_datetime_list</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rec_duration_list</span>
                        <span class="p">):</span>
                            <span class="n">end_datetime</span> <span class="o">=</span> <span class="n">beg_datetime</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span>
                                <span class="n">seconds</span><span class="o">=</span><span class="n">duration</span>
                            <span class="p">)</span>

                            <span class="n">beg_string</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertDatetimeToString</span><span class="p">(</span>
                                <span class="n">beg_datetime</span>
                            <span class="p">)</span>

                            <span class="n">end_string</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertDatetimeToString</span><span class="p">(</span>
                                <span class="n">end_datetime</span>
                            <span class="p">)</span>

                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">beg_string</span><span class="p">,</span> <span class="n">end_string</span><span class="p">))</span>

                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path_1</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">ite_file</span><span class="p">,</span> <span class="n">duration</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rec_duration_list</span>
                        <span class="p">):</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">_0 - </span><span class="si">%d</span><span class="s2">_</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">ite_file</span><span class="p">,</span> <span class="n">ite_file</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">)</span>
                            <span class="p">))</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path_0</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">end_datetime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span>
                            <span class="n">seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span>
                        <span class="p">)</span>

                        <span class="n">beg_string</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertDatetimeToString</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span>
                        <span class="p">)</span>

                        <span class="n">end_string</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertDatetimeToString</span><span class="p">(</span>
                            <span class="n">end_datetime</span>
                        <span class="p">)</span>

                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">beg_string</span><span class="p">,</span> <span class="n">end_string</span><span class="p">))</span>

                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path_1</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0_0 - 0_</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_path_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#: (*int*) Index of the currently selected label, with respect to the</span>
        <span class="c1">#: list :attr:`.ViSiAnnoT.annotevent_type_list`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span> <span class="o">=</span> <span class="mi">0</span>


        <span class="c1"># ******************************************************************* #</span>
        <span class="c1"># ********************** image annotation *************************** #</span>
        <span class="c1"># ******************************************************************* #</span>

        <span class="c1"># check type (if loaded from a configuration, then dictionary instead</span>
        <span class="c1"># of list)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">annotimage_list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># convert to list</span>
            <span class="n">annotimage_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">annotimage_list</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

        <span class="c1">#: (*list*) Image annotation labels (strings)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotimage_label_list</span> <span class="o">=</span> <span class="n">annotimage_list</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotimage_label_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># create directories if necessary</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_dir</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_dir</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotimage_label_list</span><span class="p">:</span>
                <span class="n">label_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_dir</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">label_dir</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">label_dir</span><span class="p">)</span>


        <span class="c1"># ******************************************************************* #</span>
        <span class="c1"># ***************************** zoom ******************************** #</span>
        <span class="c1"># ******************************************************************* #</span>
        <span class="c1">#: (*int*) Zoom factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoom_factor</span> <span class="o">=</span> <span class="n">zoom_factor</span>

        <span class="c1">#: (*int*) Start position (frame number) for custom manual zoom (set to</span>
        <span class="c1">#: -1 if not defined)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1">#: (*int*) End position (frame number) for custom manual zoom (set to</span>
        <span class="c1">#: -1 if not defined)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1">#: (*list*) Instances of pyqtgraph.LinearRegionItem with all the grey</span>
        <span class="c1">#: regions for custom manual zoom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">region_zoom_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#: (*list*) Instances of pyqtgraph.TextItem with the duration of the</span>
        <span class="c1">#: custom manual zoom</span>
        <span class="c1">#:</span>
        <span class="c1">#: Same length and order as :attr:`.ViSiAnnoT.wid_data_list`, so that</span>
        <span class="c1">#: one element corresponds to one signal widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">region_zoom_text_item_list</span> <span class="o">=</span> <span class="p">[]</span>


        <span class="c1"># ******************************************************************* #</span>
        <span class="c1"># ****************************** time ******************************* #</span>
        <span class="c1"># ******************************************************************* #</span>

        <span class="c1">#: (*int*) Number of frames correpsonding to</span>
        <span class="c1">#: :attr:`.ViSiAnnoT.trunc_duration`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nframes_trunc</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertTimeToFrame</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="n">trunc_duration</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sec</span><span class="o">=</span><span class="n">trunc_duration</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># check if trunc duration is above the total number of frames or</span>
        <span class="c1"># default =&gt; set it to 0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes_trunc</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes_trunc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nframes_trunc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span>
            <span class="n">trunc_duration</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1">#: (*list*) Duration of file split (tool for fast navigation), 2</span>
        <span class="c1">#: elements (int): ``(minute, second)``</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trunc_duration</span> <span class="o">=</span> <span class="n">trunc_duration</span>

        <span class="c1">#: (*int*) Number of splits in the file (tool for fast navigation)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_trunc</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes_trunc</span><span class="p">)</span>

        <span class="c1">#: (*list*) Temporal range durations intervals starting at the current</span>
        <span class="c1">#: position of the temporal cursor (tool for fast navigation)</span>
        <span class="c1">#:</span>
        <span class="c1">#: Each element is a list of integers with 2 elements:</span>
        <span class="c1">#: ``(minute, second)``.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_cursor_list</span> <span class="o">=</span> <span class="n">from_cursor_list</span>

        <span class="c1">#: (*bool*) Specify if the video is paused</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_pause_status</span> <span class="o">=</span> <span class="n">flag_pause_status</span>

        <span class="c1">#: (*int*) Index of the current frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#: (*int*) First frame that is displayed in the signal plots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#: (*int*) Last frame that is displayed in the signal plots</span>
        <span class="c1">#:</span>
        <span class="c1">#: Actually, the last frame that is displayed is</span>
        <span class="c1">#: ``:attr:`.ViSiAnnoT.last_frame` - 1``, because of zero-indexation.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes_trunc</span>

        <span class="c1">#: (*bool*) Specify if the window is running</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_processing</span> <span class="o">=</span> <span class="kc">True</span>


        <span class="c1"># ******************************************************************* #</span>
        <span class="c1"># *********************** layout definition ************************* #</span>
        <span class="c1"># ******************************************************************* #</span>

        <span class="c1"># define window organization if none provided</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">poswid_dict</span><span class="p">):</span>
            <span class="n">nb_video</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">video_dict</span><span class="p">)</span>

            <span class="c1"># check layout mode</span>
            <span class="k">if</span> <span class="n">layout_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ite_video</span><span class="p">,</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">poswid_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ite_video</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;select_trunc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nb_video</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;select_manual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_video</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;select_from_cursor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nb_video</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;annot_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">nb_video</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;annot_image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">nb_video</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;visi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">nb_video</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;zoomin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">nb_video</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;zoomout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">nb_video</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;progress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_video</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>


            <span class="k">elif</span> <span class="n">layout_mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ite_video</span><span class="p">,</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">poswid_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ite_video</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;select_trunc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_video</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;select_manual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">nb_video</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;select_from_cursor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_video</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;annot_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nb_video</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;annot_image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nb_video</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;visi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">nb_video</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;zoomin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">nb_video</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;zoomout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">nb_video</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;progress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_video</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>


            <span class="k">elif</span> <span class="n">layout_mode</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ite_video</span><span class="p">,</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">poswid_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ite_video</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;annot_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nb_video</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;annot_image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nb_video</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;visi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_video</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;zoomin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_video</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;zoomout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_video</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;progress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_video</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>


            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No layout configuration given - got mode </span><span class="si">%d</span><span class="s2">, must be 1, 2 or 3&quot;</span> <span class="o">%</span> <span class="n">layout_mode</span><span class="p">)</span>


        <span class="c1"># ******************************************************************* #</span>
        <span class="c1"># ********************* display initialization ********************** #</span>
        <span class="c1"># ******************************************************************* #</span>

        <span class="c1"># ************** create GUI application and set font **************** #</span>
        <span class="c1">#: (*QtWidgets.QApplication*) GUI initializer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">ToolsPyqtgraph</span><span class="o">.</span><span class="n">initializeDisplayAndBgColor</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="n">bg_color_plot</span>
        <span class="p">)</span>

        <span class="c1"># set style sheet</span>
        <span class="n">ToolsPyQt</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">font_name</span><span class="p">,</span> <span class="n">font_size</span><span class="p">,</span> <span class="n">font_color</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;QGroupBox&quot;</span><span class="p">,</span> <span class="s2">&quot;QComboBox&quot;</span><span class="p">,</span> <span class="s2">&quot;QPushButton&quot;</span><span class="p">,</span> <span class="s2">&quot;QRadioButton&quot;</span><span class="p">,</span> <span class="s2">&quot;QLabel&quot;</span><span class="p">,</span>
             <span class="s2">&quot;QCheckBox&quot;</span><span class="p">,</span> <span class="s2">&quot;QDateTimeEdit&quot;</span><span class="p">,</span> <span class="s2">&quot;QTimeEdit&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># get default font for titles in pyqtgraph</span>
        <span class="n">font_default_title</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">font_color</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">pt&quot;</span> <span class="o">%</span> <span class="n">font_size_title</span>
        <span class="p">}</span>

        <span class="n">font_default_axis_label</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">font_color</span><span class="p">,</span> <span class="s2">&quot;font-size&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">pt&quot;</span> <span class="o">%</span> <span class="n">font_size_title</span>
        <span class="p">}</span>


        <span class="c1"># ****************** create window and layout *********************** #</span>
        <span class="c1">#: (*QtWidgets.QWidget*) Window container</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (*QtWidgets.QGridLayout*) layout filling the window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lay</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># create window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lay</span> <span class="o">=</span> <span class="n">ToolsPyQt</span><span class="o">.</span><span class="n">createWindow</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;ViSiAnnoT&quot;</span><span class="p">,</span> <span class="n">bg_color</span><span class="o">=</span><span class="n">bg_color</span>
        <span class="p">)</span>

        <span class="c1"># listen to the callback method (keyboard interaction)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">keyPressEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyPress</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">keyReleaseEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyRelease</span>


        <span class="c1"># ************************** menu *********************************** #</span>
        <span class="c1">#: (:class:`.MenuBar`) Menu bar item, instance of a sub-class of</span>
        <span class="c1">#: **QtWidgets.QMenuBar**, by default it is hidden, see</span>
        <span class="c1">#: :meth:`.keyRelease` for the keyword shortcut for displaying it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu_bar</span> <span class="o">=</span> <span class="n">MenuBar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lay</span><span class="p">)</span>


        <span class="c1"># ********************** progress bar ******************************* #</span>
        <span class="k">if</span> <span class="s2">&quot;progress&quot;</span> <span class="ow">in</span> <span class="n">poswid_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1">#: (:class:`graphicsoverlayer.ToolsPyqtgraph.ProgressWidget`)</span>
            <span class="c1">#: Widget containing the progress bar</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wid_progress</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">createWidgetProgress</span><span class="p">(</span>
                <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;progress&#39;</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">title_style</span><span class="o">=</span><span class="n">font_default_title</span><span class="p">,</span> <span class="n">ticks_color</span><span class="o">=</span><span class="n">ticks_color</span><span class="p">,</span>
                <span class="n">ticks_size</span><span class="o">=</span><span class="n">ticks_size</span><span class="p">,</span> <span class="n">ticks_offset</span><span class="o">=</span><span class="n">ticks_offset</span>
            <span class="p">)</span>

            <span class="c1"># listen to the callbakc method</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wid_progress</span><span class="o">.</span><span class="n">getProgressPlot</span><span class="p">()</span><span class="o">.</span><span class="n">sigPlotChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mouseDraggedProgress</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No widget position given for the progress bar =&gt; add key &#39;progress&#39; to positional argument poswid_dict&quot;</span><span class="p">)</span>


        <span class="c1"># ************************ video widgets **************************** #</span>
        <span class="c1">#: (*dict*) Video widgets</span>
        <span class="c1">#:</span>
        <span class="c1">#: Key is the camera ID (string). Value is the widget</span>
        <span class="c1">#: (pyqtgraph.PlotWidget) where the corresponding video is displayed.</span>
        <span class="c1">#:</span>
        <span class="c1">#: Same keys as the position argument</span>
        <span class="c1">#: ``video_dict`` of the constructor of :class:`.ViSiAnnoT`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wid_vid_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1">#: (*dict*) Image items of the current frame</span>
        <span class="c1">#:</span>
        <span class="c1">#: Key is the camera ID (string). Value is the image item</span>
        <span class="c1">#: (pyqtgraph.ImageItem) displayed for the corresponding video</span>
        <span class="c1">#:</span>
        <span class="c1">#: Same keys as the position argument</span>
        <span class="c1">#: ``video_dict`` of the constructor of :class:`.ViSiAnnoT`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_vid_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1">#: (*dict*) Image arrays of the current frame</span>
        <span class="c1">#:</span>
        <span class="c1">#: Key is the camera ID (string). Value is a numpy array of shape</span>
        <span class="c1">#: :math:`(width, height, 3)` containing the RGB image of the current</span>
        <span class="c1">#: frame for the corresponding video.</span>
        <span class="c1">#:</span>
        <span class="c1">#: Same keys as the position argument</span>
        <span class="c1">#: ``video_dict`` of the constructor of :class:`.ViSiAnnoT`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">im_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1">#: (*dict*) Files names of the video</span>
        <span class="c1">#:</span>
        <span class="c1">#: Key is the camera ID (string). Value is the corresponding video</span>
        <span class="c1">#: file name (strin).</span>
        <span class="c1">#:</span>
        <span class="c1">#: Same keys as the position argument</span>
        <span class="c1">#: ``video_dict`` of the constructor of :class:`.ViSiAnnoT`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vid_file_name_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># create video widgets and initialize video plots</span>
        <span class="c1"># (it sets the attributes self.wid_vid_dict, self.img_vid_dict,</span>
        <span class="c1"># self.im_dict and self.vid_file_name_dict)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initVideoPlot</span><span class="p">(</span>
            <span class="n">video_dict</span><span class="p">,</span> <span class="n">poswid_dict</span><span class="p">,</span> <span class="n">font_title</span><span class="o">=</span><span class="n">font_default_title</span>
        <span class="p">)</span>


        <span class="c1"># *********************** signal widgets **************************** #</span>
        <span class="c1">#: (*list*) Widgets for signal plot, each element is an instance of</span>
        <span class="c1">#: :class:`.SignalWidget`</span>
        <span class="c1">#:</span>
        <span class="c1">#: Same length as :attr:`.sig_labels`.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#: (*list*) Plot items of the signals</span>
        <span class="c1">#:</span>
        <span class="c1">#: Each element corresponds to a signal widget in</span>
        <span class="c1">#: :attr:`.wid_data_list` (same indexing) and is a list of</span>
        <span class="c1">#: plot items (pyqtgraph.PlotDataItem)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_plot_list_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#: (*list*) Temporal cursor item for each signal</span>
        <span class="c1">#:</span>
        <span class="c1">#: Each element is an instance of pyqtgraph.InfiniteLine.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_cursor_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#: (*dict*) Lists of region items for temporal intervals</span>
        <span class="c1">#:</span>
        <span class="c1">#: Key is the ID of the widget on which temporal intervals are plotted</span>
        <span class="c1">#: (must be in :attr:`.sig_labels`). Value is a list of</span>
        <span class="c1">#: instances of pyqtgraph.LinearRegionItem displayed on the</span>
        <span class="c1">#: corresponding widget.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">region_interval_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># create signal widgets and initialize signal plots</span>
        <span class="c1"># (it sets the attributes self.wid_data_list,</span>
        <span class="c1"># self.data_plot_list_list, self.current_cursor_list and</span>
        <span class="c1"># self.region_interval_dict)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initSignalPlot</span><span class="p">(</span>
            <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;progress&#39;</span><span class="p">],</span>
            <span class="n">font_axis_label</span><span class="o">=</span><span class="n">font_default_axis_label</span><span class="p">,</span>
            <span class="n">ticks_color</span><span class="o">=</span><span class="n">ticks_color</span><span class="p">,</span>
            <span class="n">ticks_size</span><span class="o">=</span><span class="n">ticks_size</span><span class="p">,</span>
            <span class="n">ticks_offset</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">y_range_dict</span><span class="o">=</span><span class="n">y_range_dict</span><span class="p">,</span>
            <span class="n">height_widget_signal</span><span class="o">=</span><span class="n">height_widget_signal</span>
        <span class="p">)</span>

        <span class="c1"># listen to the callback methods</span>
        <span class="k">for</span> <span class="n">wid</span><span class="p">,</span> <span class="n">current_cursor</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_cursor_list</span>
        <span class="p">):</span>
            <span class="c1"># mouse click on the plot =&gt; move temporal cursor</span>
            <span class="n">wid</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">sigMouseClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signalMouseClicked</span><span class="p">)</span>

            <span class="c1"># temporal cursor dragging</span>
            <span class="n">current_cursor</span><span class="o">.</span><span class="n">sigDragged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentCursorDragged</span><span class="p">)</span>


        <span class="c1"># *********************** trunc widget ****************************** #</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trunc_duration</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">trunc_duration</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;select_trunc&quot;</span> <span class="ow">in</span> <span class="n">poswid_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1">#: (:class:`graphicsoverlayer.ToolsPyQt.ComboBox`) Combo box</span>
                <span class="c1">#: for selecting a truncated temporal range (tool for fast</span>
                <span class="c1">#: navigation)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_trunc</span> <span class="o">=</span> <span class="n">ToolsPyQt</span><span class="o">.</span><span class="n">addComboBox</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lay</span><span class="p">,</span> <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;select_trunc&#39;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTruncIntervals</span><span class="p">(),</span>
                    <span class="n">box_title</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">min </span><span class="si">%d</span><span class="s2">s temporal range&quot;</span> <span class="o">%</span>
                    <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trunc_duration</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">combo_trunc</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># listen to the callback method</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">combo_trunc</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">callComboTrunc</span>
                <span class="p">)</span>


        <span class="c1"># ************ widget for custom temporal re-scaling **************** #</span>
        <span class="k">if</span> <span class="s2">&quot;select_manual&quot;</span> <span class="ow">in</span> <span class="n">poswid_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1">#: (*QtWidgets.QDateTimeEdit*) Editor of starting datetime of</span>
            <span class="c1">#: custom temporal interval</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edit_start</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QDateTimeEdit</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QDateTime</span><span class="p">(</span>
                <span class="n">QtCore</span><span class="o">.</span><span class="n">QDate</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span><span class="o">.</span><span class="n">day</span>
                <span class="p">),</span>
                <span class="n">QtCore</span><span class="o">.</span><span class="n">QTime</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span><span class="o">.</span><span class="n">second</span>
                <span class="p">)</span>
            <span class="p">))</span>

            <span class="c1"># only for documentation</span>
            <span class="c1">#: (*QtWidgets.QPushButton*) Push button for defining the starting</span>
            <span class="c1">#: datetime of custom temporal interval as the current frame</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_push</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1">#: (*QtWidgets.QTimeEdit*) Editor of the duration of custom</span>
            <span class="c1">#: temporal interval</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edit_duration</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTimeEdit</span><span class="p">()</span>

            <span class="c1"># only for documentation</span>
            <span class="c1">#: (*QtWidgets.QPushButton*) Push button for validating custom</span>
            <span class="c1">#: temporal interval</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_edit_push</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># create widget</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createWidgetTimeEdit</span><span class="p">(</span><span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;select_manual&#39;</span><span class="p">])</span>

            <span class="c1"># listen to the callback methods</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_push</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeEditCurrent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_edit_push</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeEditOk</span><span class="p">)</span>


        <span class="c1"># *************** widget for temporal re-scaling ******************** #</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> \
            <span class="s2">&quot;select_from_cursor&quot;</span> <span class="ow">in</span> <span class="n">poswid_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> \
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">from_cursor_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#: (:class:`graphicsoverlayer.ToolsPyQt.ComboBox`) Combo box for</span>
            <span class="c1">#: selecting a temporal range starting from the current frame (tool</span>
            <span class="c1">#: for fast navigation)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_from_cursor</span> <span class="o">=</span> <span class="n">ToolsPyQt</span><span class="o">.</span><span class="n">addComboBox</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lay</span><span class="p">,</span> <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;select_from_cursor&#39;</span><span class="p">],</span>
                <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">{:&gt;02}</span><span class="s1">:</span><span class="si">{:&gt;02}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">from_cursor</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">from_cursor</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">from_cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_cursor_list</span><span class="p">],</span>
                <span class="n">box_title</span><span class="o">=</span><span class="s2">&quot;Temporal range duration&quot;</span>
            <span class="p">)</span>

            <span class="c1"># listen to the callback method</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">combo_from_cursor</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">callComboFromCursor</span>
            <span class="p">)</span>


        <span class="c1"># *********************** zoom widgets ****************************** #</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s2">&quot;visi&quot;</span> <span class="ow">in</span> <span class="n">poswid_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1">#: (*pyqtgraph.PlotWidget*) Widget with the visibility image</span>
            <span class="c1">#:</span>
            <span class="c1">#: Clicking on it sets the temporal range to the fullest</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wid_visi</span> <span class="o">=</span> <span class="n">ToolsPyqtgraph</span><span class="o">.</span><span class="n">createWidgetLogo</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lay</span><span class="p">,</span> <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;visi&#39;</span><span class="p">],</span> <span class="n">im_deco_dict</span><span class="p">[</span><span class="s2">&quot;visibility&quot;</span><span class="p">],</span>
                <span class="n">box_size</span><span class="o">=</span><span class="mi">50</span>
            <span class="p">)</span>

            <span class="c1"># listen to the callback method</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wid_visi</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">sigMouseClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visiAll</span><span class="p">)</span>


        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s2">&quot;zoomin&quot;</span> <span class="ow">in</span> <span class="n">poswid_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1">#: (*pyqtgraph.PlotWidget*) Widget containing the zoomin image</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wid_zoomin</span> <span class="o">=</span> <span class="n">ToolsPyqtgraph</span><span class="o">.</span><span class="n">createWidgetLogo</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lay</span><span class="p">,</span> <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;zoomin&#39;</span><span class="p">],</span> <span class="n">im_deco_dict</span><span class="p">[</span><span class="s2">&quot;zoomin&quot;</span><span class="p">],</span>
                <span class="n">box_size</span><span class="o">=</span><span class="mi">50</span>
            <span class="p">)</span>

            <span class="c1"># listen to the callback method</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wid_zoomin</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">sigMouseClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoomIn</span><span class="p">)</span>


        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s2">&quot;zoomout&quot;</span> <span class="ow">in</span> <span class="n">poswid_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1">#: (*pyqtgraph.PlotWidget*) Widget containing the zoomout image</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wid_zoomout</span> <span class="o">=</span> <span class="n">ToolsPyqtgraph</span><span class="o">.</span><span class="n">createWidgetLogo</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lay</span><span class="p">,</span> <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;zoomout&#39;</span><span class="p">],</span> <span class="n">im_deco_dict</span><span class="p">[</span><span class="s2">&quot;zoomout&quot;</span><span class="p">],</span>
                <span class="n">box_size</span><span class="o">=</span><span class="mi">50</span>
            <span class="p">)</span>

            <span class="c1"># listen to the callback method</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wid_zoomout</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">sigMouseClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoomOut</span><span class="p">)</span>


        <span class="c1"># ******************* event annotation widget *********************** #</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_label_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;annot_event&quot;</span> <span class="ow">in</span> <span class="n">poswid_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># for documentation only</span>
                <span class="c1">#: (*QtWidgets.QButtonGroup*) Set of the radio buttons with</span>
                <span class="c1">#: labels of events annotation</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_group_radio_label</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="c1"># for documentation only</span>
                <span class="c1">#: (*QtWidgets.QButtonGroup*) Set of the radio buttons with</span>
                <span class="c1">#: display options of events annotation</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_group_radio_disp</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="c1"># for documentation only</span>
                <span class="c1">#: (*QtWidgets.QButtonGroup*) Set of the check boxes for</span>
                <span class="c1">#: custom display of events annotation</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_group_check_custom</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="c1">#: (*QtWidgets.QButtonGroup*) Set of push buttons for</span>
                <span class="c1">#: events annotation (Sart, Stop, Add, Delete last, Display)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_group_push</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QButtonGroup</span><span class="p">()</span>

                <span class="c1">#: (*list*) Instances of QtWidgets.QLabel containing the text</span>
                <span class="c1">#: next to the push buttons grouped in</span>
                <span class="c1">#: :attr:`.ViSiAnnoT.annotevent_button_group_push`</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="c1"># create widget for events annotation</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">createWidgetAnnotEvent</span><span class="p">(</span>
                    <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;annot_event&#39;</span><span class="p">],</span> <span class="n">nb_table</span><span class="o">=</span><span class="n">nb_table_annot</span>
                <span class="p">)</span>

                <span class="c1">#: (*dict*) Lists of region items (pyqtgraph.LinearRegionItem)</span>
                <span class="c1">#: for the display of event annotations</span>
                <span class="c1">#:</span>
                <span class="c1">#: Key is a label index. Value is a list of lists, each sublist</span>
                <span class="c1">#: corresponds to one annotation and contains</span>
                <span class="c1">#: :math:`n_{wid} + 1` region items, where :math:`n_{wid}` is</span>
                <span class="c1">#: the length of :attr:`.ViSiAnnoT.wid_data_list` (number of</span>
                <span class="c1">#: signal widgets), the additional region item is for the</span>
                <span class="c1">#: progress bar (:attr:`.ViSiAnnoT.wid_progress`).</span>
                <span class="c1">#:</span>
                <span class="c1">#: For example, for 3 signal widgets and for a given label with</span>
                <span class="c1">#: 2 annotations, the value of the dictionary would be::</span>
                <span class="c1">#:</span>
                <span class="c1">#:      [</span>
                <span class="c1">#:          [</span>
                <span class="c1">#:              annot1_widProgress, annot1_wid1, annot1_wid2,</span>
                <span class="c1">#:              annot1_wid3</span>
                <span class="c1">#:          ],</span>
                <span class="c1">#:          [</span>
                <span class="c1">#:              annot2_widProgress, annot2_wid1, annot2_wid2,</span>
                <span class="c1">#:              annot2_wid3</span>
                <span class="c1">#:          ]</span>
                <span class="c1">#:      ]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">region_annotation_dict</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="c1"># plot annotations</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotAnnotEventRegions</span><span class="p">()</span>

                <span class="c1"># listen to the callback methods</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_group_push</span><span class="o">.</span><span class="n">buttonClicked</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotEventCallPushButton</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_group_radio_label</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotEventCallRadio</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_group_radio_disp</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plotAnnotEventRegions</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_group_check_custom</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plotAnnotEventRegions</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No widget position given for the event annotation =&gt; add key &#39;annot_event&#39; to positinal argument poswid_dict&quot;</span><span class="p">)</span>


        <span class="c1"># ******************* image annotation widget *********************** #</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotimage_label_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;annot_image&quot;</span> <span class="ow">in</span> <span class="n">poswid_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># for documentation only</span>
                <span class="c1">#: (*QtWidgets.QButtonGroup*) Set of radio buttons with</span>
                <span class="c1">#: labels of image extraction</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotimage_radio_button_group</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="c1"># for documentation only</span>
                <span class="c1">#: (:class:`graphicsoverlayer.ToolsPyQt.PushButton`) Push</span>
                <span class="c1">#: button for saving image extraction</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotimage_push_button</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="c1"># check if horizontal or vertical radio buttons</span>
                <span class="k">if</span> <span class="n">layout_mode</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">flag_horizontal</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flag_horizontal</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># create widget</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">createWidgetAnnotImage</span><span class="p">(</span>
                    <span class="n">poswid_dict</span><span class="p">[</span><span class="s1">&#39;annot_image&#39;</span><span class="p">],</span>
                    <span class="n">flag_horizontal</span><span class="o">=</span><span class="n">flag_horizontal</span><span class="p">,</span>
                    <span class="n">nb_table</span><span class="o">=</span><span class="n">nb_table_annot</span>
                <span class="p">)</span>

                <span class="c1"># listen to the callback method</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotimage_push_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotImageCallPushButton</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No widget position given for the image annotation =&gt; add key &#39;annot_image&#39; to positinal argument poswid_dict&quot;</span><span class="p">)</span>


        <span class="c1"># ******************************************************************* #</span>
        <span class="c1"># ************** thread for getting videos images ******************* #</span>
        <span class="c1"># ******************************************************************* #</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video_data_dict</span><span class="p">):</span>
            <span class="c1">#: (*threading.Thread*) Thread for getting video frames, connected</span>
            <span class="c1">#: to the method :meth:`.ViSiAnnoT.updateVideoFrame`</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_frame_thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">updateVideoFrame</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_frame_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>


        <span class="c1"># ******************************************************************* #</span>
        <span class="c1"># ************************ plot timer ******************************* #</span>
        <span class="c1"># ******************************************************************* #</span>

        <span class="c1">#: (*QtCore.QTimer*) Thread for updating the current frame position,</span>
        <span class="c1">#: connected to the method :meth:`.ViSiAnnoT.updatePlot`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">updatePlot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>


        <span class="c1"># ******************************************************************* #</span>
        <span class="c1"># *********************** infinite loop ***************************** #</span>
        <span class="c1"># ******************************************************************* #</span>

        <span class="c1"># this does not apply in case of long recording, because there are</span>
        <span class="c1"># other stuff to do after calling this constructor</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_long_rec</span> <span class="ow">and</span> <span class="n">flag_infinite_loop</span><span class="p">:</span>
            <span class="n">ToolsPyQt</span><span class="o">.</span><span class="n">infiniteLoopDisplay</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">)</span>

            <span class="c1"># close streams, delete temporary folders</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stopProcessing</span><span class="p">()</span>


    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># ************************ ViSiAnnoT methods **************************** #</span>
    <span class="c1"># *********************************************************************** #</span>

    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># Group: Miscellaneous methods</span>
    <span class="c1"># *********************************************************************** #</span>


<div class="viewcode-block" id="ViSiAnnoT.getTruncIntervals"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.getTruncIntervals">[docs]</a>    <span class="k">def</span> <span class="nf">getTruncIntervals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the string associated to the truncated temporal intervals defined</span>
<span class="sd">        by :attr:`.ViSiAnnoT.trunc_duration` for fast navigation</span>

<span class="sd">        :returns: list of strings</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">trunc_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ite_trunc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_trunc</span><span class="p">):</span>
            <span class="n">string_1</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertFrameToAbsoluteTimeString</span><span class="p">(</span>
                <span class="n">ite_trunc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes_trunc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">ite_trunc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_trunc</span><span class="p">:</span>
                <span class="n">string_2</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertFrameToAbsoluteTimeString</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">string_2</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertFrameToAbsoluteTimeString</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">ite_trunc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes_trunc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span>
                <span class="p">)</span>

            <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">string_1</span><span class="p">,</span> <span class="n">string_2</span><span class="p">)</span>
            <span class="n">trunc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">trunc_list</span></div>


<div class="viewcode-block" id="ViSiAnnoT.setTemporalTicks"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.setTemporalTicks">[docs]</a>    <span class="k">def</span> <span class="nf">setTemporalTicks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">temporal_info</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the ticks of the X axis of the widget and the X axis range</span>
<span class="sd">        according to a temporal range</span>

<span class="sd">        It creates temporal labels for ticks in the format HH:MM:SS.SSS.</span>
<span class="sd">        The number of ticks is specified by :attr:`.ViSiAnnoT.nb_ticks`.</span>

<span class="sd">        :param widget: widget where to set X axis ticks and X axis range,</span>
<span class="sd">            it may be any sub-class of pyqtgraph.PlotWidget, such as</span>
<span class="sd">            :class:`graphicsoverlayer.ToolsPyqtgraph.SignalWidget` or</span>
<span class="sd">            :class:`graphicsoverlayer.ToolsPyqtgraph.ProgressWidget`</span>
<span class="sd">        :type widget: pyqtgraph.PlotWidget</span>
<span class="sd">        :param temporal_info: temporal range, there are two ways to specify it:</span>

<span class="sd">            - ``(first_frame_ms, last_frame_ms)``, the temporal range is</span>
<span class="sd">              expressed in milliseconds,</span>
<span class="sd">            - ``(first_frame, last_frame, freq)``, the temporal range is</span>
<span class="sd">              expressed in number of frames sampled at the frequency ``freq``</span>
<span class="sd">        :type temporal_info: list</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">temporal_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">temporal_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">temporal_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_ticks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_ticks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">stop</span><span class="p">]</span>

        <span class="c1"># X axis range</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">setXRange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temporal_info</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">temporal_info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="c1"># define temporal labels</span>
            <span class="n">temporal_labels</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertFrameToAbsoluteTimeString</span><span class="p">(</span>
                    <span class="n">frame_id</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span>
                <span class="p">)</span> <span class="k">for</span> <span class="n">frame_id</span> <span class="ow">in</span> <span class="n">temporal_range</span>
            <span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># define temporal labels</span>
            <span class="n">temporal_labels</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertMsecToAbsoluteTimeString</span><span class="p">(</span>
                    <span class="n">msec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span>
                <span class="p">)</span> <span class="k">for</span> <span class="n">msec</span> <span class="ow">in</span> <span class="n">temporal_range</span>
            <span class="p">]</span>

        <span class="c1"># set ticks</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="p">[[(</span><span class="n">frame</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">frame</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span>
                  <span class="nb">zip</span><span class="p">(</span><span class="n">temporal_range</span><span class="p">,</span> <span class="n">temporal_labels</span><span class="p">)],</span> <span class="p">[]]</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">setTicks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.getFrameIdInMs"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.getFrameIdInMs">[docs]</a>    <span class="k">def</span> <span class="nf">getFrameIdInMs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a frame number to milliseconds</span>

<span class="sd">        :param frame_id: frame number sampled at the reference frequency</span>
<span class="sd">            :attr:`.ViSiAnnoT.fps`</span>
<span class="sd">        :type frame_id: int</span>

<span class="sd">        :returns: frame number in milliseconds</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">frame_id</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span></div>


<div class="viewcode-block" id="ViSiAnnoT.convertMsToFrameRef"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.convertMsToFrameRef">[docs]</a>    <span class="k">def</span> <span class="nf">convertMsToFrameRef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_ms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts milliseconds to frame number sampled at the reference</span>
<span class="sd">        frequency :attr:`.ViSiAnnoT.fps`</span>

<span class="sd">        :param frame_ms: frame number in milliseconds</span>
<span class="sd">        :type frame_ms: float</span>

<span class="sd">        :returns: frame number sampled at the reference frequency</span>
<span class="sd">            :attr:`.ViSiAnnoT.fps`</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">frame_ms</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.getCurrentRangeInMs"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.getCurrentRangeInMs">[docs]</a>    <span class="k">def</span> <span class="nf">getCurrentRangeInMs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the current temporal range defined by</span>
<span class="sd">        :attr:`.ViSiAnnoT.first_frame` and :attr:`.ViSiAnnoT.last_frame` to</span>
<span class="sd">        milliseconds</span>

<span class="sd">        :returns:</span>
<span class="sd">            - **first_frame_ms** (*int*) -- first frame of the current temporal</span>
<span class="sd">              range in milliseconds</span>
<span class="sd">            - **last_frame_ms** (*int*) -- last frame of the current temporal</span>
<span class="sd">              range in milliseconds</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFrameIdInMs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span><span class="p">),</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">getFrameIdInMs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span><span class="p">)</span></div>


    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># End group</span>
    <span class="c1"># *********************************************************************** #</span>


    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># Group: Methods for displaying video / plotting signals and progress bar</span>
    <span class="c1"># *********************************************************************** #</span>


<div class="viewcode-block" id="ViSiAnnoT.initVideoPlot"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.initVideoPlot">[docs]</a>    <span class="k">def</span> <span class="nf">initVideoPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_dict</span><span class="p">,</span> <span class="n">poswid_dict</span><span class="p">,</span>
                      <span class="n">font_title</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#000&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;12pt&quot;</span><span class="p">}):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the video widgets and initializes the video plots</span>

<span class="sd">        It sets the following attributes:</span>

<span class="sd">        - :attr:`.ViSiAnnoT.wid_vid_dict`</span>
<span class="sd">        - :attr:`.ViSiAnnoT.img_vid_dict`</span>
<span class="sd">        - :attr:`.ViSiAnnoT.im_dict`</span>
<span class="sd">        - :attr:`.ViSiAnnoT.vid_file_name_dict`</span>

<span class="sd">        Make sure the attribute :attr:`.ViSiAnnoT.lay` is created before</span>
<span class="sd">        calling this method.</span>

<span class="sd">        :param video_dict: video configuration, see positional argument</span>
<span class="sd">            ``video_dict`` of :class:`.ViSiAnnoT` constructor</span>
<span class="sd">        :type video_dict: dict</span>
<span class="sd">        :param poswid_dict: position of the widgets in the window, see</span>
<span class="sd">            positional argument ``poswid_dict`` of :class:`.ViSiAnnoT`</span>
<span class="sd">            constructor</span>
<span class="sd">        :type poswid_dict: dict</span>
<span class="sd">        :param font_title: font of the widget title</span>
<span class="sd">        :type font_title: dict</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="p">(</span><span class="n">video_path</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">video_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># check if widget position exists</span>
            <span class="k">if</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">poswid_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># get file name</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">video_path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vid_file_name_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span>

                <span class="c1"># create widget</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wid_vid_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_vid_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">ToolsPyqtgraph</span><span class="o">.</span><span class="n">createWidgetImage</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lay</span><span class="p">,</span> <span class="n">poswid_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">],</span>
                        <span class="n">title</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">title_style</span><span class="o">=</span><span class="n">font_title</span>
                <span class="p">)</span>

                <span class="c1"># initialize image arrays</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">im_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVideoData</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">video_data_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span>
                <span class="p">)</span>

                <span class="c1"># display first frame</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_vid_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">im_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No widget position given for video </span><span class="si">%s</span><span class="s2"> =&gt; add key </span><span class="si">%s</span><span class="s2"> to positinal argument poswid_dict&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">video_id</span><span class="p">,</span> <span class="n">video_id</span><span class="p">))</span></div>


<div class="viewcode-block" id="ViSiAnnoT.initSignalPlot"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.initSignalPlot">[docs]</a>    <span class="k">def</span> <span class="nf">initSignalPlot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">progbar_wid_pos</span><span class="p">,</span>
        <span class="n">font_axis_label</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#000&quot;</span><span class="p">,</span> <span class="s2">&quot;font-size&quot;</span><span class="p">:</span> <span class="s2">&quot;12pt&quot;</span><span class="p">},</span>
        <span class="n">ticks_color</span><span class="o">=</span><span class="p">(</span><span class="mi">93</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">89</span><span class="p">),</span> <span class="n">ticks_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ticks_offset</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">current_cursor_style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s2">&quot;F00&quot;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
        <span class="n">current_cursor_dragged_style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s2">&quot;F0F&quot;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
        <span class="n">y_range_dict</span><span class="o">=</span><span class="p">{},</span> <span class="n">height_widget_signal</span><span class="o">=</span><span class="mi">150</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the signal widgets and initializes the signal plots</span>

<span class="sd">        The widgets are automatically positioned below the progress bar.</span>

<span class="sd">        It sets the following attributes:</span>

<span class="sd">        - :attr:`.ViSiAnnoT.wid_data_list`</span>
<span class="sd">        - :attr:`.ViSiAnnoT.data_plot_list_list`</span>
<span class="sd">        - :attr:`.ViSiAnnoT.current_cursor_list`</span>
<span class="sd">        - :attr:`.ViSiAnnoT.region_interval_dict`</span>

<span class="sd">        Make sure the attributes :attr:`.ViSiAnnoT.lay`,</span>
<span class="sd">        :attr:`.ViSiAnnoT.sig_list_list`, :attr:`.ViSiAnnoT.sig_labels`,</span>
<span class="sd">        :attr:`.ViSiAnnoT.threshold_dict` and :attr:`.ViSiAnnoT.interval_dict`</span>
<span class="sd">        are defined before calling this method.</span>

<span class="sd">        :param progbar_wid_pos: position of the progress bar widget, length 2</span>
<span class="sd">            ``(row, col)`` or 4 ``(row, col, rowspan, colspan)``</span>
<span class="sd">        :type progbar_wid_pos: tuple of list</span>
<span class="sd">        :param font_axis_label: font of the Y axis label</span>
<span class="sd">        :type font_axis_label: dict</span>
<span class="sd">        :param ticks_color: ticks color (RGB)</span>
<span class="sd">        :type ticks_color: tuple or list</span>
<span class="sd">        :param ticks_size: size of the ticks text</span>
<span class="sd">        :type ticks_size: int</span>
<span class="sd">        :param ticks_offset: offset between the ticks and the text</span>
<span class="sd">        :type ticks_offset: int</span>
<span class="sd">        :param current_cursor_style: plot style of the temporal cursor</span>
<span class="sd">        :type current_cursor_style: dict</span>
<span class="sd">        :param current_cursor_dragged_style: plot style of the temporal cursor</span>
<span class="sd">            when dragged</span>
<span class="sd">        :type current_cursor_dragged_style: dict</span>
<span class="sd">        :param y_range_dict: visible Y range for signal widgets, see positional</span>
<span class="sd">            argument ``y_range_dict`` of :class:`.ViSiAnnoT` constructor</span>
<span class="sd">        :type y_range_dict: dict</span>
<span class="sd">        :param height_widget_signal: minimum height in pixels of the signal</span>
<span class="sd">            widgets</span>
<span class="sd">        :type height_widget_signal: int</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get current range in milliseconds</span>
        <span class="n">first_frame_ms</span><span class="p">,</span> <span class="n">last_frame_ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCurrentRangeInMs</span><span class="p">()</span>

        <span class="c1"># convert progress bar widget position to a list</span>
        <span class="n">pos_sig</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">progbar_wid_pos</span><span class="p">)</span>

        <span class="c1"># loop on signals</span>
        <span class="k">for</span> <span class="n">ite_sig</span><span class="p">,</span> <span class="p">(</span><span class="n">type_data</span><span class="p">,</span> <span class="n">sig_list</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig_labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_list_list</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="c1"># get position of the widget relatively to the progress bar</span>
            <span class="n">pos_sig</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># create scroll area</span>
            <span class="k">if</span> <span class="n">ite_sig</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">scroll_lay</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ToolsPyQt</span><span class="o">.</span><span class="n">addScrollArea</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lay</span><span class="p">,</span> <span class="n">pos_sig</span><span class="p">,</span> <span class="n">flag_ignore_wheel_event</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>

            <span class="c1"># get Y range</span>
            <span class="k">if</span> <span class="n">type_data</span> <span class="ow">in</span> <span class="n">y_range_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">y_range</span> <span class="o">=</span> <span class="n">y_range_dict</span><span class="p">[</span><span class="n">type_data</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">y_range</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># create widget</span>
            <span class="n">wid</span> <span class="o">=</span> <span class="n">ToolsPyqtgraph</span><span class="o">.</span><span class="n">createWidgetSignal</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lay</span><span class="p">,</span> <span class="n">pos_sig</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="n">y_range</span><span class="p">,</span>
                <span class="n">left_label</span><span class="o">=</span><span class="n">type_data</span><span class="p">,</span> <span class="n">left_label_style</span><span class="o">=</span><span class="n">font_axis_label</span><span class="p">,</span>
                <span class="n">ticks_color</span><span class="o">=</span><span class="n">ticks_color</span><span class="p">,</span> <span class="n">ticks_size</span><span class="o">=</span><span class="n">ticks_size</span><span class="p">,</span>
                <span class="n">ticks_offset</span><span class="o">=</span><span class="n">ticks_offset</span>
            <span class="p">)</span>

            <span class="c1"># add widget to scroll area</span>
            <span class="n">wid</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="n">height_widget_signal</span><span class="p">)</span>
            <span class="n">scroll_lay</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">wid</span><span class="p">)</span>

            <span class="c1"># append widget to list of widgets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wid</span><span class="p">)</span>

            <span class="c1"># reconnect to keypress event callback, so that keypress events of</span>
            <span class="c1"># scroll are ignored</span>
            <span class="n">wid</span><span class="o">.</span><span class="n">keyPressEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyPress</span>

            <span class="c1"># create legend item</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">legend</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">LegendItem</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
                <span class="n">legend</span><span class="o">.</span><span class="n">setParentItem</span><span class="p">(</span><span class="n">wid</span><span class="o">.</span><span class="n">graphicsItem</span><span class="p">())</span>

            <span class="c1"># loop on sub-signals for the widget</span>
            <span class="n">data_plot_list_tmp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">sig</span> <span class="ow">in</span> <span class="n">sig_list</span><span class="p">:</span>
                <span class="c1"># define temporal range for the signal</span>
                <span class="n">data_in_current_range</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">getDataInRange</span><span class="p">(</span>
                    <span class="n">first_frame_ms</span><span class="p">,</span> <span class="n">last_frame_ms</span>
                <span class="p">)</span>

                <span class="c1"># plot signal in the widget</span>
                <span class="n">plot</span> <span class="o">=</span> <span class="n">ToolsPyqtgraph</span><span class="o">.</span><span class="n">addPlotTo2DWidget</span><span class="p">(</span>
                    <span class="n">wid</span><span class="p">,</span> <span class="n">data_in_current_range</span><span class="p">,</span>
                    <span class="n">flag_nan_void</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot_style</span><span class="o">=</span><span class="n">sig</span><span class="o">.</span><span class="n">getPlotStyle</span><span class="p">()</span>
                <span class="p">)</span>

                <span class="n">data_plot_list_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>

                <span class="c1"># add legend</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">sig</span><span class="o">.</span><span class="n">getLegendText</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">legend</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">sig</span><span class="o">.</span><span class="n">getLegendText</span><span class="p">())</span>

            <span class="c1"># append list of plot list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_plot_list_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_plot_list_tmp</span><span class="p">)</span>

            <span class="c1"># create the infinite line for the current cursor</span>
            <span class="n">current_cursor</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span>
                <span class="n">angle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">last_frame_ms</span><span class="p">],</span>
                <span class="n">pen</span><span class="o">=</span><span class="n">current_cursor_style</span><span class="p">,</span> <span class="n">hoverPen</span><span class="o">=</span><span class="n">current_cursor_dragged_style</span>
            <span class="p">)</span>

            <span class="n">wid</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">current_cursor</span><span class="p">)</span>
            <span class="n">current_cursor</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_cursor_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_cursor</span><span class="p">)</span>

            <span class="c1"># set temporal ticks and X axis range</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTemporalTicks</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="p">(</span><span class="n">first_frame_ms</span><span class="p">,</span> <span class="n">last_frame_ms</span><span class="p">))</span>

            <span class="c1"># check if there are intervals to plot</span>
            <span class="k">if</span> <span class="n">type_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># loop on interval data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">region_interval_dict</span><span class="p">[</span><span class="n">type_data</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">intervals</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_dict</span><span class="p">[</span><span class="n">type_data</span><span class="p">]:</span>
                    <span class="c1"># plot intervals</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">region_interval_dict</span><span class="p">[</span><span class="n">type_data</span><span class="p">]</span> <span class="o">+=</span> \
                        <span class="n">ViSiAnnoT</span><span class="o">.</span><span class="n">plotIntervals</span><span class="p">(</span><span class="n">intervals</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>

            <span class="c1"># check if there are thresholds to plot</span>
            <span class="k">if</span> <span class="n">type_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold_dict</span><span class="p">[</span><span class="n">type_data</span><span class="p">]:</span>
                    <span class="n">infinite_line</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span>
                        <span class="n">pos</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
                    <span class="p">)</span>

                    <span class="n">wid</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">infinite_line</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.getVideoData"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.getVideoData">[docs]</a>    <span class="k">def</span> <span class="nf">getVideoData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_video</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets video frame at the current frame :attr:`.frame_id`</span>

<span class="sd">        :param data_video: video data to read</span>
<span class="sd">        :type data_video: cv2.VideoCapture</span>

<span class="sd">        :returns: RGB image of the current frame, shape</span>
<span class="sd">            :math:`(width, height, 3)`</span>
<span class="sd">        :rtype: numpy array</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check data video</span>
        <span class="k">if</span> <span class="n">data_video</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># set the video stream at the current frame</span>
            <span class="n">data_video</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">)</span>

            <span class="c1"># read image</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">im</span> <span class="o">=</span> <span class="n">data_video</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># check if reading is successful</span>
        <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
            <span class="c1"># cv2 returns BGR =&gt; converted to RGB</span>
            <span class="c1"># cv2 returns image with shape (height,width,3) =&gt; transposed to</span>
            <span class="c1"># (width, height, 3) for display</span>
            <span class="k">return</span> <span class="n">ToolsImage</span><span class="o">.</span><span class="n">transformImage</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if no image read, returns black image</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span></div>


<div class="viewcode-block" id="ViSiAnnoT.updateVideoFrame"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.updateVideoFrame">[docs]</a>    <span class="k">def</span> <span class="nf">updateVideoFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the video stream (launched in a thread)</span>

<span class="sd">        Called by the thread :attr:`.update_frame_thread`.</span>

<span class="sd">        It updates the attribute :attr:`.im_dict` with the image at</span>
<span class="sd">        the current frame.</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check if the process still goes on</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_processing</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_pause_status</span><span class="p">:</span>
                <span class="c1"># update images at the current frame</span>
                <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">data_video</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">im_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVideoData</span><span class="p">(</span><span class="n">data_video</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.stopProcessing"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.stopProcessing">[docs]</a>    <span class="k">def</span> <span class="nf">stopProcessing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes streams (elements of :attr:`.video_data_dict`) and</span>
<span class="sd">        deletes temporary signal folder</span>

<span class="sd">        It sets the value of :attr:`.flag_processing` to ``False`` so</span>
<span class="sd">        that the thread :attr:`.update_frame_thread` is stopped.</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_processing</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># check if annotation directory exists</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_dir</span><span class="p">):</span>
            <span class="c1"># get list of files/folders in the annotation directory</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;delete empty annotation folders/files if necessary&quot;</span><span class="p">)</span>
            <span class="n">annot_path_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_dir</span><span class="p">)</span>

            <span class="c1"># get file name of event annotation of protected label</span>
            <span class="n">protected_name_0</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">-datetime.txt&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annot_file_base</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_protected_label</span>
            <span class="p">)</span>
            <span class="n">protected_name_1</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">-frame.txt&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annot_file_base</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_protected_label</span>
            <span class="p">)</span>

            <span class="c1"># loop on annotation files/folders</span>
            <span class="k">for</span> <span class="n">annot_file_name</span> <span class="ow">in</span> <span class="n">annot_path_list</span><span class="p">:</span>
                <span class="c1"># get path of file/folder</span>
                <span class="n">annot_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_dir</span><span class="p">,</span> <span class="n">annot_file_name</span><span class="p">)</span>

                <span class="c1"># split extension</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">annot_file_name</span><span class="p">)</span>

                <span class="c1"># check if directory of image annotation</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">annot_path</span><span class="p">)</span> <span class="ow">and</span> \
                        <span class="n">annot_file_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotimage_label_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">annot_path</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                        <span class="n">rmtree</span><span class="p">(</span><span class="n">annot_path</span><span class="p">)</span>

                <span class="c1"># check if file of event annotation</span>
                <span class="k">elif</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;.txt&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;datetime&quot;</span> <span class="ow">in</span> <span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;frame&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">):</span>
                    <span class="c1"># check if empty file</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">annot_path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># remove empty file</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">annot_path</span><span class="p">)</span>

            <span class="c1"># update the list of files/folders in the annotation directory</span>
            <span class="n">annot_path_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_dir</span><span class="p">)</span>

            <span class="c1"># check if empty annotation directory (or only filled with</span>
            <span class="c1"># event annotation of protected label)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">annot_path_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">annot_path_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> \
                <span class="n">annot_path_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">protected_name_0</span> <span class="ow">and</span> \
                    <span class="n">annot_path_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">protected_name_1</span><span class="p">:</span>
                <span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_dir</span><span class="p">)</span>

            <span class="c1"># check if parent annotation directory is empty</span>
            <span class="n">parent_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_dir</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">parent_dir</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">rmtree</span><span class="p">(</span><span class="n">parent_dir</span><span class="p">)</span>

        <span class="c1"># close videos</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;close videos (if any)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">data_video</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_data_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">data_video</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data_video</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

        <span class="c1"># delete temporary files</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_long_rec</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;delete temporary signal files&quot;</span><span class="p">)</span>
            <span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_name</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.updatePlot"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.updatePlot">[docs]</a>    <span class="k">def</span> <span class="nf">updatePlot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates (during playback) the displayed video frame and the plots of</span>
<span class="sd">        the temporal cursor at the current frame :attr:`.frame_id`</span>

<span class="sd">        It is called by the thread :attr:`.timer`.</span>

<span class="sd">        The displayed video frame and the plots are updated by calling the</span>
<span class="sd">        method :meth:`.plotFrameIdPosition`.</span>

<span class="sd">        It is only effective if :attr:`.flag_pause_status` is</span>
<span class="sd">        ``False``.</span>

<span class="sd">        It increments the value of :attr:`.frame_id`.</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># in order to get processing time for updating plot</span>
        <span class="n">time_start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

        <span class="c1"># update plot only if pause status is False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_pause_status</span><span class="p">:</span>
            <span class="c1"># plot temporal cursor at the value of self.frame_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotFrameIdPosition</span><span class="p">()</span>

            <span class="c1"># increment current frame</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># plot in a loop</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="c1"># sleep</span>
        <span class="n">sleep</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">-</span> <span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)))</span></div>


<div class="viewcode-block" id="ViSiAnnoT.updateFrameId"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.updateFrameId">[docs]</a>    <span class="k">def</span> <span class="nf">updateFrameId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the value of current frame :attr:`.frame_id` and updates</span>
<span class="sd">        the displayed video frame and the plots of the temporal cursor at new</span>
<span class="sd">        current frame</span>

<span class="sd">        The displayed video frame and the plots are updated by calling the</span>
<span class="sd">        method :meth:`.plotFrameIdPosition`.</span>

<span class="sd">        :param frame_id: new current frame index</span>
<span class="sd">        :type frame_id: int</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># update frame ID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="n">frame_id</span>

        <span class="c1"># get image if pause status is true</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_pause_status</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">data_video</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">im_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVideoData</span><span class="p">(</span><span class="n">data_video</span><span class="p">)</span>

        <span class="c1"># plot frame id position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotFrameIdPosition</span><span class="p">()</span></div>


<div class="viewcode-block" id="ViSiAnnoT.updateProgressBarTitle"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.updateProgressBarTitle">[docs]</a>    <span class="k">def</span> <span class="nf">updateProgressBarTitle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the title of the progress bar :attr:`.wid_progress`</span>
<span class="sd">        with the values of the current temporal range defined by</span>
<span class="sd">        :attr:`.first_frame` and :attr:`.last_frame`</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">current_range_string</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertFrameToString</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span>
        <span class="p">)</span>

        <span class="n">frame_id_string</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertFrameToAbsoluteDatetimeString</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wid_progress</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (frame </span><span class="si">%d</span><span class="s1">) - temporal range duration: </span><span class="si">%s</span><span class="s1">&#39;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">frame_id_string</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span> <span class="n">current_range_string</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.plotFrameIdPosition"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.plotFrameIdPosition">[docs]</a>    <span class="k">def</span> <span class="nf">plotFrameIdPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the displayed video frame and the plots of the temporal cursor</span>
<span class="sd">        at the current frame position :attr:`.frame_id`</span>

<span class="sd">        If :attr:`.frame_id` is out of the temporal range (defined by</span>
<span class="sd">        :attr:`.first_frame` and :attr:`.last_frame`), then</span>
<span class="sd">        the temporal range is updated. For example, in the context of long</span>
<span class="sd">        recording, this might happen when navigating from one file to another.</span>
<span class="sd">        If the temporal range is updated, then the method</span>
<span class="sd">        :meth:`.updateSignalPlot` is called in order to update the</span>
<span class="sd">        signal plots with the new temporal range.</span>

<span class="sd">        The attribute :attr:`.img_vid_dict` is set with the values in</span>
<span class="sd">        :attr:`.im_dict` in order to update the displayed video</span>
<span class="sd">        frame.</span>

<span class="sd">        If the navigation point of the progress bar is not dragged, then the</span>
<span class="sd">        attribute :attr:`.wid_progress` is modified in order to</span>
<span class="sd">        update the position of the navigation point.</span>

<span class="sd">        The attribute :attr:`.current_cursor_list` is set in order to</span>
<span class="sd">        update the position of the temporal cursor in the signal widgets.</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check if frame_id overtakes the current range</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span><span class="p">:</span>
            <span class="c1"># check if frame id overtakes the video</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_long_rec</span><span class="p">:</span>
                    <span class="c1"># single recording</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># long recordings =&gt; change file</span>
                    <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nextRecording</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># define new range (with same temporal width as previously)</span>
                <span class="n">temporal_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span>
                <span class="k">if</span> <span class="n">temporal_width</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">-</span> <span class="n">temporal_width</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span>

                <span class="k">elif</span> <span class="n">temporal_width</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">+</span> <span class="n">temporal_width</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">+</span> <span class="n">temporal_width</span>

                <span class="c1"># update signals plot</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateSignalPlot</span><span class="p">()</span>

        <span class="c1"># check if frame_id undertakes the current range</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span><span class="p">:</span>
            <span class="c1"># check if frame undertakes the video</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_long_rec</span><span class="p">:</span>
                <span class="c1"># long recordings =&gt; change file</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">previousRecording</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># define new range (with same temporal width as previously)</span>
                <span class="n">temporal_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">-</span> <span class="n">temporal_width</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">=</span> <span class="n">temporal_width</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">-</span> <span class="n">temporal_width</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">-</span> <span class="n">temporal_width</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">-</span> <span class="n">temporal_width</span>

                <span class="c1"># update signals plots</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateSignalPlot</span><span class="p">()</span>

        <span class="c1"># update progress bar (if the progress bar is dragged, then there is no</span>
        <span class="c1"># need to update it)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wid_progress</span><span class="o">.</span><span class="n">getDragged</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wid_progress</span><span class="o">.</span><span class="n">getProgressPlot</span><span class="p">()</span><span class="o">.</span><span class="n">setData</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># update temporal cursor</span>
        <span class="k">for</span> <span class="n">current_cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_cursor_list</span><span class="p">:</span>
            <span class="n">current_cursor</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFrameIdInMs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">))</span>

        <span class="c1"># print current frame id and current temporal width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateProgressBarTitle</span><span class="p">()</span>

        <span class="c1"># update video image</span>
        <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">img_vid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_vid_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">img_vid</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">im_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">])</span></div>


<div class="viewcode-block" id="ViSiAnnoT.updateSignalPlot"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.updateSignalPlot">[docs]</a>    <span class="k">def</span> <span class="nf">updateSignalPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag_reset_combo_trunc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">flag_reset_combo_from_cursor</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the signal plots so that it spans the current temporal range</span>
<span class="sd">        defined by :attr:`.first_frame` and</span>
<span class="sd">        :attr:`.last_frame`</span>

<span class="sd">        :param flag_reset_combo_trunc: specify if the combo box</span>
<span class="sd">            :attr:`.combo_trunc` must be reset</span>
<span class="sd">        :type flag_reset_combo_trunc: bool</span>
<span class="sd">        :param flag_reset_combo_from_cursor: specify if the combo box</span>
<span class="sd">            :attr:`.combo_from_cursor` must be reset</span>
<span class="sd">        :type flag_reset_combo_from_cursor: bool</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># reset combo boxes</span>
        <span class="k">if</span> <span class="n">flag_reset_combo_trunc</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">combo_trunc</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="n">flag_reset_combo_from_cursor</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">combo_from_cursor</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># get current range in milliseconds</span>
        <span class="n">first_frame_ms</span><span class="p">,</span> <span class="n">last_frame_ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCurrentRangeInMs</span><span class="p">()</span>

        <span class="c1"># print current frame id and current temporal width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateProgressBarTitle</span><span class="p">()</span>

        <span class="c1"># update progress bar limits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wid_progress</span><span class="o">.</span><span class="n">getFirstLine</span><span class="p">()</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wid_progress</span><span class="o">.</span><span class="n">getLastLine</span><span class="p">()</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># update plots</span>
        <span class="k">for</span> <span class="n">wid</span><span class="p">,</span> <span class="n">sig_list</span><span class="p">,</span> <span class="n">data_plot_list</span><span class="p">,</span> <span class="n">current_plot</span><span class="p">,</span> <span class="n">type_data</span> <span class="ow">in</span> \
            <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_list_list</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_plot_list_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_cursor_list</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sig_labels</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">sig</span><span class="p">,</span> <span class="n">data_plot</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sig_list</span><span class="p">,</span> <span class="n">data_plot_list</span><span class="p">):</span>
                <span class="c1"># get data in the current temporal range</span>
                <span class="n">data_in_current_range</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">getDataInRange</span><span class="p">(</span>
                    <span class="n">first_frame_ms</span><span class="p">,</span> <span class="n">last_frame_ms</span>
                <span class="p">)</span>

                <span class="c1"># check if empty signal in the temporal range</span>
                <span class="k">if</span> <span class="n">data_in_current_range</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">data_plot</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># delete NaNs</span>
                    <span class="n">data_in_current_range</span> <span class="o">=</span> <span class="n">ToolsPyqtgraph</span><span class="o">.</span><span class="n">deleteNaNForPlot</span><span class="p">(</span>
                        <span class="n">data_in_current_range</span>
                    <span class="p">)</span>

                    <span class="c1"># signal plot</span>
                    <span class="n">data_plot</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">data_in_current_range</span><span class="p">)</span>

            <span class="c1"># X axis ticks and range</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTemporalTicks</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="p">(</span><span class="n">first_frame_ms</span><span class="p">,</span> <span class="n">last_frame_ms</span><span class="p">))</span>

            <span class="c1"># update temporal cursor bounds (for dragging)</span>
            <span class="n">current_plot</span><span class="o">.</span><span class="n">setBounds</span><span class="p">([</span><span class="n">first_frame_ms</span><span class="p">,</span> <span class="n">last_frame_ms</span><span class="p">])</span>

            <span class="c1"># check if there are intervals to plot</span>
            <span class="k">if</span> <span class="n">type_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># clear existing regions</span>
                <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_interval_dict</span><span class="p">[</span><span class="n">type_data</span><span class="p">]:</span>
                    <span class="n">wid</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>

                <span class="c1"># plot detection</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">region_interval_dict</span><span class="p">[</span><span class="n">type_data</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">interval</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_dict</span><span class="p">[</span><span class="n">type_data</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">region_interval_dict</span><span class="p">[</span><span class="n">type_data</span><span class="p">]</span> <span class="o">+=</span> \
                        <span class="n">ViSiAnnoT</span><span class="o">.</span><span class="n">plotIntervals</span><span class="p">(</span><span class="n">interval</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span></div>


    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># End group</span>
    <span class="c1"># *********************************************************************** #</span>


    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># Group: Methods for plotting region items (pyqtgraph.LinearRegionItem)</span>
    <span class="c1"># *********************************************************************** #</span>


<div class="viewcode-block" id="ViSiAnnoT.removeItemInWidgets"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.removeItemInWidgets">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">removeItemInWidgets</span><span class="p">(</span><span class="n">wid_list</span><span class="p">,</span> <span class="n">item_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes an item from a list of widgets</span>

<span class="sd">        :param wid_list: widgets where to remove an item, each element must</span>
<span class="sd">            have a method ``removeItem`` (for example an instance of</span>
<span class="sd">            pyqtgraph.PlotWidget)</span>
<span class="sd">        :type wid_list: list</span>
<span class="sd">        :param item_list: items to remove from widgets, same length as</span>
<span class="sd">            ``wid_list``, each element corresponds to one element of</span>
<span class="sd">            ``wid_list``</span>
<span class="sd">        :type item_list: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">wid</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wid_list</span><span class="p">,</span> <span class="n">item_list</span><span class="p">):</span>
            <span class="n">wid</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.addItemToSignals"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.addItemToSignals">[docs]</a>    <span class="k">def</span> <span class="nf">addItemToSignals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays items in the signal widgets</span>

<span class="sd">        :param item_list: items to display in the signal widgets, same length</span>
<span class="sd">            as :attr:`.wid_data_list`, each element corresponds to</span>
<span class="sd">            one signal widget</span>
<span class="sd">        :type item_list: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">wid</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">,</span> <span class="n">item_list</span><span class="p">):</span>
            <span class="n">wid</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.removeRegionInWidgets"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.removeRegionInWidgets">[docs]</a>    <span class="k">def</span> <span class="nf">removeRegionInWidgets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a region item from the progress bar widget and the signal</span>
<span class="sd">        widgets</span>

<span class="sd">        :param region_list: instances of pyqtgraph.LinearRegionItem, all</span>
<span class="sd">            elements correspond to the same region displayed in the different</span>
<span class="sd">            widgets, first element is the region item displayed in the progress</span>
<span class="sd">            bar widget (:attr:`.wid_progress`) and the remaining</span>
<span class="sd">            elements are the region items displayed in the signal widgets</span>
<span class="sd">            (same order as :attr:`.wid_data_list`)</span>
<span class="sd">        :type region_list: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ViSiAnnoT</span><span class="o">.</span><span class="n">removeItemInWidgets</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">wid_progress</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">,</span> <span class="n">region_list</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.addRegionToWidgets"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.addRegionToWidgets">[docs]</a>    <span class="k">def</span> <span class="nf">addRegionToWidgets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bound_1</span><span class="p">,</span> <span class="n">bound_2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">50</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates and displays a region item (pyqtgraph.LinearRegionItem) for the</span>
<span class="sd">        progress bar (:attr:`.wid_progress`) and the signal widgets</span>
<span class="sd">        (:attr:`.wid_data_list`)</span>

<span class="sd">        :param bound_1: start frame of the region item (sampled at the</span>
<span class="sd">            reference frequency :attr:`.ViSiAnnoT.fps`)</span>
<span class="sd">        :type bound_1: int</span>
<span class="sd">        :param bound_2: end frame of the region item (sampled at the</span>
<span class="sd">            reference frequency :attr:`.ViSiAnnoT.fps`)</span>
<span class="sd">        :type bound_2: int</span>
<span class="sd">        :param color: plot color (RGBA)</span>
<span class="sd">        :type color: tuple or list</span>

<span class="sd">        :returns: instances of pyqtgraph.LinearRegionItem (corresponding to the</span>
<span class="sd">            same region), first element displayed in the progress bar widget,</span>
<span class="sd">            remaining elements displayed in the widget signals</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">region_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># display region in progress bar</span>
        <span class="n">region</span> <span class="o">=</span> <span class="n">ViSiAnnoT</span><span class="o">.</span><span class="n">addRegionToWidget</span><span class="p">(</span>
            <span class="n">bound_1</span><span class="p">,</span> <span class="n">bound_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wid_progress</span><span class="p">,</span> <span class="n">color</span>
        <span class="p">)</span>

        <span class="n">region_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>

        <span class="c1"># display region in each signal plot</span>
        <span class="k">for</span> <span class="n">wid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">:</span>
            <span class="c1"># convert bounds in milliseconds</span>
            <span class="n">bound_1_ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFrameIdInMs</span><span class="p">(</span><span class="n">bound_1</span><span class="p">)</span>
            <span class="n">bound_2_ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFrameIdInMs</span><span class="p">(</span><span class="n">bound_2</span><span class="p">)</span>

            <span class="c1"># plot regions in signal widgets</span>
            <span class="n">region</span> <span class="o">=</span> <span class="n">ViSiAnnoT</span><span class="o">.</span><span class="n">addRegionToWidget</span><span class="p">(</span>
                <span class="n">bound_1_ms</span><span class="p">,</span> <span class="n">bound_2_ms</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">color</span>
            <span class="p">)</span>

            <span class="n">region_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">region_list</span></div>


<div class="viewcode-block" id="ViSiAnnoT.plotIntervals"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.plotIntervals">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">plotIntervals</span><span class="p">(</span><span class="n">data_interval</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots intervals data as a region</span>

<span class="sd">        :param data_interval: intervals to be displayed, shape</span>
<span class="sd">            :math:`(n_{intervals}, 2)`, each line is an interval with start</span>
<span class="sd">            frame and end frame (sampled at ``freq``, relatively to</span>
<span class="sd">            :attr:`.ViSAnnoT.beginning_datetime` if used inside</span>
<span class="sd">            :class:`.ViSiAnnoT`) ; the intervals might be expressed in</span>
<span class="sd">            milliseconds, then ``freq`` must be set to ``0``</span>

<span class="sd">            WARNING: test this feature in asynchronous long recording (because</span>
<span class="sd">            of relative to :attr:`.ViSAnnoT.beginning_datetime`)</span>
<span class="sd">        :type data_interval: numpy array</span>
<span class="sd">        :param wid: widget where to plot intervals, might be any widget class</span>
<span class="sd">            with a method ``addItem``</span>
<span class="sd">        :type wid: pyqtgraph.PlotWidget</span>
<span class="sd">        :param freq: sampling frequency of intervals frames, set it to ``0`` if</span>
<span class="sd">            intervals expressed in milliseconds</span>
<span class="sd">        :type freq: float</span>
<span class="sd">        :param color: plot color (RGBA)</span>
<span class="sd">        :type color: tuple or list</span>

<span class="sd">        :returns: instances of pyqtgraph.LinearRegionItem</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">region_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">interval</span> <span class="ow">in</span> <span class="n">data_interval</span><span class="p">:</span>
            <span class="n">det_0</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">det_1</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># convert interval frames to milliseconds</span>
            <span class="k">if</span> <span class="n">freq</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">det_0</span> <span class="o">=</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">det_0</span> <span class="o">/</span> <span class="n">freq</span>
                <span class="n">det_1</span> <span class="o">=</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">det_1</span> <span class="o">/</span> <span class="n">freq</span>

            <span class="c1"># plot region</span>
            <span class="n">region</span> <span class="o">=</span> <span class="n">ViSiAnnoT</span><span class="o">.</span><span class="n">addRegionToWidget</span><span class="p">(</span><span class="n">det_0</span><span class="p">,</span> <span class="n">det_1</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
            <span class="n">region_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">region_list</span></div>


<div class="viewcode-block" id="ViSiAnnoT.createTextItem"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.createTextItem">[docs]</a>    <span class="k">def</span> <span class="nf">createTextItem</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">pos_ms</span><span class="p">,</span> <span class="n">pos_y_list</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">border_color</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">border_width</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a text item to the signal widgets</span>
<span class="sd">        (:attr:`.wid_data_list`)</span>

<span class="sd">        See</span>
<span class="sd">        https://pyqtgraph.readthedocs.io/en/latest/functions.html#pyqtgraph.mkColor</span>
<span class="sd">        for supported color formats.</span>

<span class="sd">        :param text: text to display in the signal widgets (it is the same in</span>
<span class="sd">            each widget)</span>
<span class="sd">        :type text: str</span>
<span class="sd">        :param pos_ms: temporal position (X axis) of the text item in</span>
<span class="sd">            milliseconds</span>
<span class="sd">        :type pos_ms: float</span>
<span class="sd">        :param pos_y_list: position on the Y axis of the text item in each</span>
<span class="sd">            signal widget, same length as :attr:`.wid_data_list`</span>
<span class="sd">        :type pos_y_list: float</span>
<span class="sd">        :param text_color: color of the text</span>
<span class="sd">        :type text_color: tuple or list or str</span>
<span class="sd">        :param border_color: color of the text item border</span>
<span class="sd">        :type border_color: tuple or list or str</span>
<span class="sd">        :param border_width: width of the text item border in pixels</span>
<span class="sd">        :type border_width: int</span>

<span class="sd">        :returns: instances of pyqtgraph.TextItem, each element corresponds to</span>
<span class="sd">            a signal widget, same length and order as</span>
<span class="sd">            :attr:`wid_data_list`</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># initialize list of text items</span>
        <span class="n">text_item_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># loop on signal widgets</span>
        <span class="k">for</span> <span class="n">wid</span><span class="p">,</span> <span class="n">pos_y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">,</span> <span class="n">pos_y_list</span><span class="p">):</span>
            <span class="c1"># create text item</span>
            <span class="n">text_item</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">TextItem</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">text_color</span><span class="p">,</span>
                                    <span class="n">border</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">border_color</span><span class="p">,</span>
                                            <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">border_width</span><span class="p">})</span>

            <span class="c1"># set text item position</span>
            <span class="n">text_item</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">pos_ms</span><span class="p">,</span> <span class="n">pos_y</span><span class="p">)</span>

            <span class="c1"># add text item to signal widget</span>
            <span class="n">wid</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">text_item</span><span class="p">)</span>

            <span class="c1"># append list of text items</span>
            <span class="n">text_item_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text_item</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">text_item_list</span></div>


<div class="viewcode-block" id="ViSiAnnoT.addRegionToWidget"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.addRegionToWidget">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">addRegionToWidget</span><span class="p">(</span><span class="n">bound_1</span><span class="p">,</span> <span class="n">bound_2</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a region item (pyqtgraph.LinearRegionItem) and displays it in a</span>
<span class="sd">        widget</span>

<span class="sd">        :param bound_1: start value of the region item (expressed as a</span>
<span class="sd">            coordinate in the X axis of the widget)</span>
<span class="sd">        :type bound_1: int</span>
<span class="sd">        :param bound_2: end value of the region item (expressed as a</span>
<span class="sd">            coordinate in the X axis of the widget)</span>
<span class="sd">        :type bound_2: int</span>
<span class="sd">        :param wid: widget where to display the region item, might be any</span>
<span class="sd">            widget class with a method ``addItem``</span>
<span class="sd">        :type wid: pyqtgraph.PlotWidget</span>
<span class="sd">        :param color: plot color (RGBA)</span>
<span class="sd">        :type color: tuple or list</span>

<span class="sd">        :returns: region item displayed in the widget</span>
<span class="sd">        :rtype: pyqtgraph.LinearRegionItem</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># pen disabled for linux compatibility</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">region</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">LinearRegionItem</span><span class="p">(</span><span class="n">movable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">brush</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                         <span class="n">pen</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">region</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">LinearRegionItem</span><span class="p">(</span><span class="n">movable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">brush</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

        <span class="c1"># set region boundaries</span>
        <span class="n">region</span><span class="o">.</span><span class="n">setRegion</span><span class="p">([</span><span class="n">bound_1</span><span class="p">,</span> <span class="n">bound_2</span><span class="p">])</span>

        <span class="c1"># add region to widget</span>
        <span class="n">wid</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">region</span></div>


    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># End group</span>
    <span class="c1"># *********************************************************************** #</span>

    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># Group: Methods for mouse interaction with plots (mostly callback methods)</span>
    <span class="c1"># *********************************************************************** #</span>


<div class="viewcode-block" id="ViSiAnnoT.mouseDraggedProgress"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.mouseDraggedProgress">[docs]</a>    <span class="k">def</span> <span class="nf">mouseDraggedProgress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method for mouse dragging of the navigation point in the</span>
<span class="sd">        progress bar widget :attr:`.wid_progress`</span>

<span class="sd">        It updates the current frame :attr:`.frame_id` at the</span>
<span class="sd">        current position defined by the mouse in the progress bar widget.</span>

<span class="sd">        Connected to the signal ``sigPlotChanged`` of the scatter plot item of</span>
<span class="sd">        :attr:`.wid_progress` (accessed with the method</span>
<span class="sd">        :meth:`graphicsoverlayer.ToolsPyqtgraph.ProgressWidget.getProgressPlot`).</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check if dragging</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wid_progress</span><span class="o">.</span><span class="n">getDragged</span><span class="p">():</span>
            <span class="c1"># get the temporal position</span>
            <span class="n">temporal_position</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wid_progress</span><span class="o">.</span><span class="n">getProgressPlot</span><span class="p">()</span><span class="o">.</span><span class="n">getData</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># update current frame</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="n">temporal_position</span><span class="p">)</span>

            <span class="c1"># define new range</span>
            <span class="n">current_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">+</span> <span class="n">current_range</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">-</span> <span class="n">current_range</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">+</span> <span class="n">current_range</span>

            <span class="c1"># update plots signals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateSignalPlot</span><span class="p">()</span></div>


<div class="viewcode-block" id="ViSiAnnoT.currentCursorDragged"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.currentCursorDragged">[docs]</a>    <span class="k">def</span> <span class="nf">currentCursorDragged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method for mouse dragging of the temporal cursor in a signal</span>
<span class="sd">        widget</span>

<span class="sd">        It updates the current frame :attr:`.frame_id` at the current</span>
<span class="sd">        position of the temporal cursor.</span>

<span class="sd">        Connected to the signal ``sigDragged`` of the elements of</span>
<span class="sd">        :attr:`.current_cursor_list`.</span>

<span class="sd">        :param cursor: temporal cursor that is dragged</span>
<span class="sd">        :type cursor: pyqtgraph.InfiniteLine</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># update frame id (convert frame id from signal to ref)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convertMsToFrameRef</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">value</span><span class="p">())))</span></div>


<div class="viewcode-block" id="ViSiAnnoT.currentCursorClicked"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.currentCursorClicked">[docs]</a>    <span class="k">def</span> <span class="nf">currentCursorClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the current frame :attr:`.frame_id` at the specified</span>
<span class="sd">        position</span>

<span class="sd">        If the specified position is out of bounds of the current temporal</span>
<span class="sd">        range defined by :attr:`.first_frame` and :attr:`.last_frame`,</span>
<span class="sd">        then the current frame is not set.</span>

<span class="sd">        :param position: frame number (sampled at the reference frequency</span>
<span class="sd">            :attr:`.ViSiAnnoT.fps`)</span>
<span class="sd">        :type position: int</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check if temporal_position is in the current range</span>
        <span class="k">if</span> <span class="n">position</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="ow">and</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span><span class="p">:</span>
            <span class="c1"># update current frame</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="n">position</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.signalMouseClicked"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.signalMouseClicked">[docs]</a>    <span class="k">def</span> <span class="nf">signalMouseClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method for managing mouse click on the signal widgets</span>
<span class="sd">        (:attr:`.wid_data_list`)</span>

<span class="sd">        Connected to the signal ``sigMouseClicked`` of the elements of</span>
<span class="sd">        :attr:`.wid_data_list`.</span>

<span class="sd">        On one hand, it allows to define manually a temporal interval on which</span>
<span class="sd">        to zoom by calling the method :meth:`.zoomOrAnnotClicked`.</span>

<span class="sd">        On the other hand, it allows to define a new annotation and to add it</span>
<span class="sd">        the annotation file by calling the method</span>
<span class="sd">        :meth:`zoomOrAnnotClicked`. Also, it allows to delete</span>
<span class="sd">        manually a specific annotation by calling the method</span>
<span class="sd">        :meth:`.annotEventDeleteClicked`.</span>

<span class="sd">        It also updates the position of the temporal cursor by calling the</span>
<span class="sd">        method :meth:`.currentCursorClicked`.</span>

<span class="sd">        :param ev: emitted when the mouse is clicked/moved</span>
<span class="sd">        :type ev: QtGui.QMouseEvent</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">keyboard_modifiers</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">modifiers</span><span class="p">()</span>

        <span class="c1"># map the mouse position to the plot coordinates</span>
        <span class="n">pos_frame</span><span class="p">,</span> <span class="n">pos_ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMouseTemporalPosition</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>

        <span class="c1"># check if mouse clicked on a signal widget</span>
        <span class="k">if</span> <span class="n">pos_frame</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># check if left button clicked</span>
            <span class="k">if</span> <span class="n">ev</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">:</span>
                <span class="c1"># crtl+shift key =&gt; delete annotation</span>
                <span class="k">if</span> <span class="n">keyboard_modifiers</span> <span class="o">==</span> \
                        <span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ShiftModifier</span><span class="p">):</span>
                    <span class="c1"># only when display mode is on</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;On&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">annotEventDeleteClicked</span><span class="p">(</span><span class="n">pos_frame</span><span class="p">)</span>

                <span class="c1"># alt key =&gt; display description</span>
                <span class="k">elif</span> <span class="n">keyboard_modifiers</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AltModifier</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotEventDescription</span><span class="p">(</span><span class="n">ev</span><span class="p">,</span> <span class="n">pos_frame</span><span class="p">,</span> <span class="n">pos_ms</span><span class="p">)</span>

                <span class="c1"># no key modifier (only left button clicked)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">currentCursorClicked</span><span class="p">(</span><span class="n">pos_frame</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">ev</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zoomOrAnnotClicked</span><span class="p">(</span><span class="n">ev</span><span class="p">,</span> <span class="n">pos_frame</span><span class="p">,</span> <span class="n">pos_ms</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.getMouseYPosition"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.getMouseYPosition">[docs]</a>    <span class="k">def</span> <span class="nf">getMouseYPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets position of the mouse on the Y axis of all the signal widgets</span>

<span class="sd">        :param ev: emitted when the mouse is clicked/moved</span>
<span class="sd">        :type ev: QtGui.QMouseEvent</span>

<span class="sd">        :returns: same length as :attr:`.wid_data_list`, each element</span>
<span class="sd">            is the position of the mouse on the Y axis in the corresponding</span>
<span class="sd">            signal widget, it returns ``[]`` if the mouse clicked on a label</span>
<span class="sd">            item (most likely the widget title)</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check what is being clicked</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">scenePos</span><span class="p">()):</span>
            <span class="c1"># if widget title is checked, nothing is returned</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">is</span> <span class="n">pg</span><span class="o">.</span><span class="n">graphicsItems</span><span class="o">.</span><span class="n">LabelItem</span><span class="o">.</span><span class="n">LabelItem</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># map the mouse position to the plot coordinates</span>
        <span class="n">position_y_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">wid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">:</span>
            <span class="n">position_y</span> <span class="o">=</span> <span class="n">wid</span><span class="o">.</span><span class="n">getViewBox</span><span class="p">()</span><span class="o">.</span><span class="n">mapToView</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>
            <span class="n">position_y_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position_y</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">position_y_list</span></div>


<div class="viewcode-block" id="ViSiAnnoT.getMouseTemporalPosition"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.getMouseTemporalPosition">[docs]</a>    <span class="k">def</span> <span class="nf">getMouseTemporalPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the position of the mouse on the X axis</span>

<span class="sd">        :param ev: emitted when the mouse is clicked/moved</span>
<span class="sd">        :type ev: QtGui.QMouseEvent</span>

<span class="sd">        :returns:</span>
<span class="sd">            - **position_frame** (*int*) -- position of the mouse on the X axis</span>
<span class="sd">              in frame number (sampled at the reference frequency</span>
<span class="sd">              :attr:`ViSiAnnoT.fps`), ``-1`` if the mouse clicked on a label</span>
<span class="sd">              item (most likely the widget title)</span>
<span class="sd">            - **position_ms** (*float*) -- position of the mouse on the X axis</span>
<span class="sd">              in milliseconds, ``-1`` if the mouse clicked on a label item</span>
<span class="sd">              (most likely the widget title)</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check what is being clicked</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">scenePos</span><span class="p">()):</span>
            <span class="c1"># if widget title is checked, nothing is returned</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">is</span> <span class="n">pg</span><span class="o">.</span><span class="n">graphicsItems</span><span class="o">.</span><span class="n">LabelItem</span><span class="o">.</span><span class="n">LabelItem</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># map the mouse position to the plot coordinates</span>
        <span class="n">position_ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getViewBox</span><span class="p">()</span><span class="o">.</span><span class="n">mapToView</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>

        <span class="c1"># convert from signal to ref</span>
        <span class="n">position_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convertMsToFrameRef</span><span class="p">(</span><span class="n">position_ms</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">position_frame</span><span class="p">,</span> <span class="n">position_ms</span></div>


<div class="viewcode-block" id="ViSiAnnoT.zoomOrAnnotClicked"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.zoomOrAnnotClicked">[docs]</a>    <span class="k">def</span> <span class="nf">zoomOrAnnotClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">,</span> <span class="n">pos_frame</span><span class="p">,</span> <span class="n">pos_ms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Manages mouse click for zoom or annotation</span>

<span class="sd">        :param ev: emitted when the mouse is clicked/moved</span>
<span class="sd">        :type ev: QtGui.QMouseEvent</span>
<span class="sd">        :param pos_frame: mouse position on the X axis in frame number (sampled</span>
<span class="sd">            at the reference frequency :attr:`ViSiAnnoT.fps`)</span>
<span class="sd">        :type pos_frame: int</span>
<span class="sd">        :param pos_ms: mouse position on the X axis in milliseconds</span>
<span class="sd">        :type pos_ms: int</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">keyboard_modifiers</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">modifiers</span><span class="p">()</span>

        <span class="c1"># define position 1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_1</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># zoom</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">pos_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

            <span class="c1"># ctrl key =&gt; add annotation</span>
            <span class="k">if</span> <span class="n">keyboard_modifiers</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotEventSetTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># define position 2</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_2</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># zoom</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">pos_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

            <span class="c1"># ctrl key =&gt; add annotation</span>
            <span class="k">if</span> <span class="n">keyboard_modifiers</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotEventSetTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># swap pos_1 and pos_2 if necessary</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_1</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_2</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_1</span>

            <span class="c1"># plot zoom region</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">region_zoom_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addRegionToWidgets</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_2</span>
            <span class="p">)</span>

            <span class="c1"># compute zoom region duration</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span>

            <span class="c1"># get list of Y position of the mouse in each signal widget</span>
            <span class="n">pos_y_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMouseYPosition</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>

            <span class="c1"># display zoom region duration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">region_zoom_text_item_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createTextItem</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2"> s&quot;</span> <span class="o">%</span> <span class="n">duration</span><span class="p">,</span> <span class="n">pos_ms</span><span class="p">,</span> <span class="n">pos_y_list</span><span class="p">,</span>
                <span class="n">border_color</span><span class="o">=</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># both positions defined</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_1</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_2</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># check if click is inside the zoom in area</span>
            <span class="k">if</span> <span class="n">pos_frame</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_1</span> <span class="ow">and</span> <span class="n">pos_frame</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_2</span><span class="p">:</span>
                <span class="c1"># ctrl key =&gt; add annotation</span>
                <span class="k">if</span> <span class="n">keyboard_modifiers</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotEventAdd</span><span class="p">()</span>

                <span class="c1"># no ctrl key =&gt; zoom</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># define new range</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_2</span>

                    <span class="c1"># update current frame if necessary</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> \
                            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span><span class="p">)</span>

                    <span class="c1"># update signals plots</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">updateSignalPlot</span><span class="p">()</span>

            <span class="c1"># in case the click is outside the zoom in area</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_array</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># reset annotation times</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotEventResetTime</span><span class="p">()</span>

            <span class="c1"># remove zoom regions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removeRegionInWidgets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">region_zoom_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">region_zoom_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># remove zoom regions description</span>
            <span class="n">ViSiAnnoT</span><span class="o">.</span><span class="n">removeItemInWidgets</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_zoom_text_item_list</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">region_zoom_text_item_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># reset zoom positions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zoom_pos_2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span></div>


    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># End group</span>
    <span class="c1"># *********************************************************************** #</span>

    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># Group: Callback methods for zooming in/out</span>
    <span class="c1"># *********************************************************************** #</span>


<div class="viewcode-block" id="ViSiAnnoT.visiAll"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.visiAll">[docs]</a>    <span class="k">def</span> <span class="nf">visiAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method for resetting the temporal range (defined by</span>
<span class="sd">        :attr:`.first_frame` and :attr:`.last_frame`) to</span>
<span class="sd">        the fullest</span>

<span class="sd">        Connected to the signal ``sigMouseClicked`` of the scene attribute of</span>
<span class="sd">        :attr:`.wid_visi`.</span>

<span class="sd">        It sets :attr:`.first_frame` to ``0`` and</span>
<span class="sd">        :attr:`.last_frame` to :attr:`.nframes`. Then it</span>
<span class="sd">        calls the method :meth:`.updateSignalPlot`.</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># update range: all video</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span>

        <span class="c1"># update signal plots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateSignalPlot</span><span class="p">()</span></div>


<div class="viewcode-block" id="ViSiAnnoT.zoomIn"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.zoomIn">[docs]</a>    <span class="k">def</span> <span class="nf">zoomIn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method for zooming in</span>

<span class="sd">        Connected to the signal ``sigMouseClicked`` of the scene attribute of</span>
<span class="sd">        :attr:`.wid_zoomin`.</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get current X axis range</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">axis_range_min</span><span class="p">,</span> <span class="n">axis_range_max</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">.</span><span class="n">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># convert from signal to ref</span>
        <span class="n">axis_range_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convertMsToFrameRef</span><span class="p">(</span><span class="n">axis_range_min</span><span class="p">)</span>
        <span class="n">axis_range_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convertMsToFrameRef</span><span class="p">(</span><span class="n">axis_range_max</span><span class="p">)</span>

        <span class="c1"># check if current range is large enough for zoom in</span>
        <span class="k">if</span> <span class="n">axis_range_max</span> <span class="o">-</span> <span class="n">axis_range_min</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="c1"># compute the range on the left/right side of the temporal cursor</span>
            <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">-</span> <span class="n">axis_range_min</span>
            <span class="n">right</span> <span class="o">=</span> <span class="n">axis_range_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span>

            <span class="c1"># compute the first frame and the last frame after zooming</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">-</span> <span class="n">left</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_factor</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">+</span> <span class="n">right</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_factor</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span>
            <span class="p">)</span>

            <span class="c1"># update signals plots</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateSignalPlot</span><span class="p">()</span></div>


<div class="viewcode-block" id="ViSiAnnoT.zoomOut"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.zoomOut">[docs]</a>    <span class="k">def</span> <span class="nf">zoomOut</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method for zooming out</span>

<span class="sd">        Connected to the signal ``sigMouseClicked`` of the scene attribute of</span>
<span class="sd">        :attr:`.wid_zoomout`.</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get current X axis range</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">axis_range_min</span><span class="p">,</span> <span class="n">axis_range_max</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">.</span><span class="n">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># convert from signal to ref</span>
        <span class="n">axis_range_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convertMsToFrameRef</span><span class="p">(</span><span class="n">axis_range_min</span><span class="p">)</span>
        <span class="n">axis_range_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convertMsToFrameRef</span><span class="p">(</span><span class="n">axis_range_max</span><span class="p">)</span>

        <span class="c1"># compute the range on the left/right side of the temporal cursor</span>
        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">-</span> <span class="n">axis_range_min</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">axis_range_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span>

        <span class="c1"># compute the first frame and the last frame after zooming</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">-</span> <span class="n">left</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_factor</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">+</span> <span class="n">right</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_factor</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span>
        <span class="p">)</span>

        <span class="c1"># update signals plots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateSignalPlot</span><span class="p">()</span></div>


    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># End group</span>
    <span class="c1"># *********************************************************************** #</span>

    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># Group: Methods for managing image annotations</span>
    <span class="c1"># *********************************************************************** #</span>


<div class="viewcode-block" id="ViSiAnnoT.annotImageCallPushButton"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.annotImageCallPushButton">[docs]</a>    <span class="k">def</span> <span class="nf">annotImageCallPushButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method for saving an annotated image</span>

<span class="sd">        Connected to the signal ``clicked`` of</span>
<span class="sd">        :attr:`.annotimage_push_button`.</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get current label</span>
        <span class="n">current_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotimage_radio_button_group</span><span class="o">.</span><span class="n">checkedButton</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># get output directory</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_dir</span><span class="p">,</span> <span class="n">current_label</span><span class="p">)</span>

        <span class="c1"># loop on cameras</span>
        <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vid_file_name_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># read image</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">ToolsImage</span><span class="o">.</span><span class="n">transformImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">im_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">])</span>

            <span class="c1"># save image</span>
            <span class="n">im_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">.png&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">)</span>
            <span class="n">imwrite</span><span class="p">(</span><span class="n">im_path</span><span class="p">,</span> <span class="n">im</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;image saved: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">im_path</span><span class="p">)</span></div>


    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># End group</span>
    <span class="c1"># *********************************************************************** #</span>

    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># Group: Methods for managing event annotations</span>
    <span class="c1"># *********************************************************************** #</span>


<div class="viewcode-block" id="ViSiAnnoT.annotEventCallRadio"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.annotEventCallRadio">[docs]</a>    <span class="k">def</span> <span class="nf">annotEventCallRadio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method for changing event annotation label with the radio</span>
<span class="sd">        buttons</span>

<span class="sd">        Connected to the signal ``buttonClicked`` of</span>
<span class="sd">        :attr:`.annotevent_button_group_radio_label`.</span>

<span class="sd">        It calls the method :meth:`.annotEventChangeLabel` with</span>
<span class="sd">        ``ev.text()`` as input.</span>

<span class="sd">        :param ev: radio button that has been clicked</span>
<span class="sd">        :type ev: QtWidgets.QRadioButton</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get the new annotation file name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotEventChangeLabel</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">text</span><span class="p">())</span></div>


<div class="viewcode-block" id="ViSiAnnoT.annotEventChangeLabel"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.annotEventChangeLabel">[docs]</a>    <span class="k">def</span> <span class="nf">annotEventChangeLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes event annotation label (loads new annotation file)</span>

<span class="sd">        It sets the value of the following attributes:</span>

<span class="sd">        - :attr:`.current_label_id` with the index of the new</span>
<span class="sd">          annotation label in :attr:`.annotevent_label_list`</span>
<span class="sd">        - :attr:`.annotevent_path_list` with the new list of</span>
<span class="sd">          annotation file paths (by calling</span>
<span class="sd">          :meth:`.annotEventGetPathList`)</span>

<span class="sd">        It also manages the display of the annotations.</span>

<span class="sd">        :param new_label: new annotation label</span>
<span class="sd">        :type new_label: str</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># update current label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_label_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">new_label</span><span class="p">)</span>

        <span class="c1"># get the new annotation file name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_path_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotEventGetPathList</span><span class="p">(</span><span class="n">new_label</span><span class="p">)</span>

        <span class="c1"># get number of annotation already stored</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_path_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">ToolsData</span><span class="o">.</span><span class="n">getTxtLines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_path_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">nb_annot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">nb_annot</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># update label with the number of annotations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Nb: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">nb_annot</span><span class="p">)</span>

        <span class="c1"># update label with the start and end time</span>
        <span class="n">non_zero_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">non_zero_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="s2">&quot;YYYY-MM-DD hh:mm:ss.sss&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">non_zero_array</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="s2">&quot;YYYY-MM-DD hh:mm:ss.sss&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># plot annotations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotAnnotEventRegions</span><span class="p">()</span></div>


<div class="viewcode-block" id="ViSiAnnoT.annotEventGetPathList"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.annotEventGetPathList">[docs]</a>    <span class="k">def</span> <span class="nf">annotEventGetPathList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the path of the annotation files corresponding to the input label</span>

<span class="sd">        :param label: event annotation label</span>
<span class="sd">        :type label: str</span>

<span class="sd">        :returns: paths of the annotation files, each element corresponds to an</span>
<span class="sd">            annotation type (see :attr:`.annotevent_type_list`)</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">annotevent_path_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">annot_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_type_list</span><span class="p">:</span>
            <span class="n">annotevent_path_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">.txt&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">annot_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">annot_file_base</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">annot_type</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">annotevent_path_list</span></div>


<div class="viewcode-block" id="ViSiAnnoT.annotEventSetTime"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.annotEventSetTime">[docs]</a>    <span class="k">def</span> <span class="nf">annotEventSetTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_id</span><span class="p">,</span> <span class="n">annot_position</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets an annotation value for the current label, either start or end</span>
<span class="sd">        timestamp of the event annotation</span>

<span class="sd">        It sets the values of</span>
<span class="sd">        ``ViSiAnnoT.annotevent_array[ViSiAnnoT.current_label_id, annot_position]``.</span>

<span class="sd">        :param frame_id: frame number of the annotation timestamp (sampled at</span>
<span class="sd">            the reference frequency :attr:`.ViSiAnnoT.fps`)</span>
<span class="sd">        :type frame_id: int</span>
<span class="sd">        :param annot_position: specify if start timestamp (``0``) or end</span>
<span class="sd">            timestamp (``1``)</span>
<span class="sd">        :type annot_position: int</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">annot_position</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">annot_position</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_label_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># set the beginning time of the annotated interval to</span>
            <span class="c1"># the current frame</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">,</span> <span class="n">annot_position</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertFrameToAbsoluteDatetimeString</span><span class="p">(</span>
                    <span class="n">frame_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">,</span> <span class="n">annot_position</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> \
                <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">_</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec_id</span><span class="p">,</span> <span class="n">frame_id</span><span class="p">)</span>

            <span class="c1"># display the beginning time of the annotated interval</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="n">annot_position</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">,</span> <span class="n">annot_position</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.annotEventResetTime"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.annotEventResetTime">[docs]</a>    <span class="k">def</span> <span class="nf">annotEventResetTime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets the annotations value for the current label</span>

<span class="sd">        It sets ``ViSiAnnoT.annotevent_array[ViSiAnnoT.annotevent_current_label_id]``</span>
<span class="sd">        to zeros.</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># reset the beginning and ending times of the annotated interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

        <span class="c1"># reset the displayed beginning and ending times of the annotated interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;YYYY-MM-DD hh:mm:ss.sss&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;YYYY-MM-DD hh:mm:ss.sss&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.annotEventAdd"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.annotEventAdd">[docs]</a>    <span class="k">def</span> <span class="nf">annotEventAdd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds an event annotation to the current label</span>

<span class="sd">        It writes in the annotation files</span>
<span class="sd">        (:attr:`.annotevent_path_list`).</span>

<span class="sd">        If the annotation start timestamp or end timestamp is not defined, then</span>
<span class="sd">        nothing happens.</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check if beginning time or ending of the annotated interval is empty</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Empty annotation !!! Cannot write file.&quot;</span><span class="p">)</span>

        <span class="c1"># otherwise all good</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># convert annotation to datetime</span>
            <span class="n">annot_datetime_0</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertStringToDatetime</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;format_T&quot;</span><span class="p">,</span> <span class="n">time_zone</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_zone</span>
            <span class="p">)</span>

            <span class="n">annot_datetime_1</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertStringToDatetime</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;format_T&quot;</span><span class="p">,</span> <span class="n">time_zone</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_zone</span>
            <span class="p">)</span>

            <span class="c1"># check if annotation must be reversed</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">annot_datetime_1</span> <span class="o">-</span> <span class="n">annot_datetime_0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>

            <span class="c1"># append the annotated interval to the annotation file</span>
            <span class="k">for</span> <span class="n">ite_annot_type</span><span class="p">,</span> <span class="n">annot_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_path_list</span>
            <span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">annot_path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ite_annot_type</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ite_annot_type</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

            <span class="c1"># update the number of annotations</span>
            <span class="n">nb_annot</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Nb: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">nb_annot</span><span class="p">)</span>

            <span class="c1"># if display mode is on, display the appended interval</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;On&quot;</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span> <span class="ow">in</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">region_annotation_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">region_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotEventAddRegion</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_color_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">]</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">region_annotation_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region_list</span><span class="p">)</span>

            <span class="c1"># reset the beginning and ending times of the annotated interval</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotEventResetTime</span><span class="p">()</span></div>


<div class="viewcode-block" id="ViSiAnnoT.annotEventIdFromPosition"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.annotEventIdFromPosition">[docs]</a>    <span class="k">def</span> <span class="nf">annotEventIdFromPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Looks for the index of the annotation at the given position (for the</span>
<span class="sd">        current label)</span>

<span class="sd">        :param position: frame number (sampled at the reference frequency</span>
<span class="sd">            :attr:`.ViSiAnnoT.fps`)</span>
<span class="sd">        :type position: int</span>

<span class="sd">        :returns: index of the annotation (i.e. line number in the annotation</span>
<span class="sd">            file), returns ``-1`` if no annotation at ``position``</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># initialize output</span>
        <span class="n">annot_id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># check if annotation file exists</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_path_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="c1"># convert mouse position to datetime</span>
            <span class="n">position_date_time</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertFrameToAbsoluteDatetime</span><span class="p">(</span>
                <span class="n">position</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span>
            <span class="p">)</span>

            <span class="c1"># get annotations for current label</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">ToolsData</span><span class="o">.</span><span class="n">getTxtLines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_path_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># loop on annotations</span>
            <span class="k">for</span> <span class="n">ite_annot</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="c1"># get annotation</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="n">start_date_time</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertStringToDatetime</span><span class="p">(</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; - &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;format_T&quot;</span><span class="p">,</span> <span class="n">time_zone</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_zone</span>
                <span class="p">)</span>

                <span class="n">end_date_time</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertStringToDatetime</span><span class="p">(</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; - &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;format_T&quot;</span><span class="p">,</span> <span class="n">time_zone</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_zone</span>
                <span class="p">)</span>

                <span class="c1"># check if mouse position is in the annotation interval</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">position_date_time</span> <span class="o">-</span> <span class="n">start_date_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> \
                        <span class="p">(</span><span class="n">end_date_time</span> <span class="o">-</span> <span class="n">position_date_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">annot_id</span> <span class="o">=</span> <span class="n">ite_annot</span>
                    <span class="k">break</span>

        <span class="k">return</span> <span class="n">annot_id</span></div>


<div class="viewcode-block" id="ViSiAnnoT.annotEventDescription"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.annotEventDescription">[docs]</a>    <span class="k">def</span> <span class="nf">annotEventDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">,</span> <span class="n">pos_frame</span><span class="p">,</span> <span class="n">pos_ms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates and displays text items in signal widgets with the description</span>
<span class="sd">        of the event annotation that has been clicked on</span>

<span class="sd">        :param ev: radio button that has been clicked</span>
<span class="sd">        :type ev: QtWidgets.QRadioButton</span>
<span class="sd">        :param pos_frame: frame number (sampled at the reference frequency</span>
<span class="sd">            :attr:`ViSiAnnoT.fps`) corresponding to the mouse position on the X</span>
<span class="sd">            axis of the signal widget</span>
<span class="sd">        :type pos_frame: int</span>
<span class="sd">        :param pos_ms: mouse position on the X axis of the signal widget in</span>
<span class="sd">            milliseconds</span>
<span class="sd">        :type pos_ms: float</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get annotation ID that has been clicked</span>
        <span class="n">annot_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotEventIdFromPosition</span><span class="p">(</span><span class="n">pos_frame</span><span class="p">)</span>

        <span class="c1"># check if mouse clicked on an annotation</span>
        <span class="k">if</span> <span class="n">annot_id</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># get dictionary with description text items for the current label</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span> <span class="ow">in</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_description_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">description_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_description_dict</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span>
                <span class="p">]</span>

            <span class="c1"># create dictionary with description items for the current label</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">description_dict</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_description_dict</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">description_dict</span>

            <span class="c1"># check if description already displayed</span>
            <span class="k">if</span> <span class="n">annot_id</span> <span class="ow">in</span> <span class="n">description_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># remove display</span>
                <span class="n">ViSiAnnoT</span><span class="o">.</span><span class="n">removeItemInWidgets</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">,</span> <span class="n">description_dict</span><span class="p">[</span><span class="n">annot_id</span><span class="p">]</span>
                <span class="p">)</span>

                <span class="c1"># delete list of description text items from dictionary</span>
                <span class="k">del</span> <span class="n">description_dict</span><span class="p">[</span><span class="n">annot_id</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># get list of Y position of the mouse in each signal widget</span>
                <span class="n">pos_y_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMouseYPosition</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>

                <span class="c1"># get date-time string annotation</span>
                <span class="n">annot</span> <span class="o">=</span> <span class="n">ToolsData</span><span class="o">.</span><span class="n">getTxtLines</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_path_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)[</span><span class="n">annot_id</span><span class="p">]</span>

                <span class="c1"># get date-time start/stop of the annotation</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="n">annot</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; - &quot;</span><span class="p">)</span>

                <span class="c1"># convert date-time string to datetime</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertStringToDatetime</span><span class="p">(</span>
                    <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;format_T&quot;</span><span class="p">,</span> <span class="n">time_zone</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_zone</span>
                <span class="p">)</span>

                <span class="n">stop</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertStringToDatetime</span><span class="p">(</span>
                    <span class="n">stop</span><span class="p">,</span> <span class="s2">&quot;format_T&quot;</span><span class="p">,</span> <span class="n">time_zone</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_zone</span>
                <span class="p">)</span>

                <span class="c1"># compute annotation duration</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

                <span class="c1"># get annotation description</span>
                <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - </span><span class="si">%.3f</span><span class="s2"> s&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_label_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">],</span>
                    <span class="n">duration</span>
                <span class="p">)</span>

                <span class="c1"># get description color</span>
                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_color_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">]</span>

                <span class="c1"># create list of description text items for the annotation</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_description_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">][</span><span class="n">annot_id</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">createTextItem</span><span class="p">(</span>
                        <span class="n">description</span><span class="p">,</span> <span class="n">pos_ms</span><span class="p">,</span> <span class="n">pos_y_list</span><span class="p">,</span> <span class="n">border_color</span><span class="o">=</span><span class="n">color</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.annotEventDeleteClicked"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.annotEventDeleteClicked">[docs]</a>    <span class="k">def</span> <span class="nf">annotEventDeleteClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes an annotion that is clicked with mouse</span>

<span class="sd">        :param position: frame number (sampled at the reference frequency</span>
<span class="sd">            :attr:`.ViSiAnnoT.fps`) corresponding to the mouse position on the</span>
<span class="sd">            X axis of the signal widgets</span>
<span class="sd">        :type position: int</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get annotated event ID</span>
        <span class="n">annot_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotEventIdFromPosition</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>

        <span class="c1"># check if an annotated event must be deleted</span>
        <span class="k">if</span> <span class="n">annot_id</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># delete annotation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotEventDelete</span><span class="p">(</span><span class="n">annot_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.deleteLineInFile"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.deleteLineInFile">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">deleteLineInFile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">line_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class method for deleting a line in a txt file</span>

<span class="sd">        :param path: path to the text file</span>
<span class="sd">        :type path: str</span>
<span class="sd">        :param line_id: number of the line to delete (zero-indexed)</span>
<span class="sd">        :type line_id: int</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># read annotation file lines</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">ToolsData</span><span class="o">.</span><span class="n">getTxtLines</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># remove specified line</span>
        <span class="k">del</span> <span class="n">lines</span><span class="p">[</span><span class="n">line_id</span><span class="p">]</span>

        <span class="c1"># rewrite annotation file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.annotEventDelete"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.annotEventDelete">[docs]</a>    <span class="k">def</span> <span class="nf">annotEventDelete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annot_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes a specific annotation for the current label</span>

<span class="sd">        :param annot_id: index of the annotation to delete</span>
<span class="sd">        :type annot_id: int</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># delete annotation in the txt file</span>
        <span class="k">for</span> <span class="n">annot_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_path_list</span><span class="p">:</span>
            <span class="n">ViSiAnnoT</span><span class="o">.</span><span class="n">deleteLineInFile</span><span class="p">(</span><span class="n">annot_path</span><span class="p">,</span> <span class="n">annot_id</span><span class="p">)</span>

        <span class="c1"># update number of annotations</span>
        <span class="n">nb_annot</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">nb_annot</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nb_annot</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Nb: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">nb_annot</span><span class="p">)</span>

        <span class="c1"># delete annotation description if necessary</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span> <span class="ow">in</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_description_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">description_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_description_dict</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span>
            <span class="p">]</span>

            <span class="k">if</span> <span class="n">annot_id</span> <span class="ow">in</span> <span class="n">description_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">ViSiAnnoT</span><span class="o">.</span><span class="n">removeItemInWidgets</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">,</span> <span class="n">description_dict</span><span class="p">[</span><span class="n">annot_id</span><span class="p">]</span>
                <span class="p">)</span>

                <span class="k">del</span> <span class="n">description_dict</span><span class="p">[</span><span class="n">annot_id</span><span class="p">]</span>

            <span class="k">elif</span> <span class="n">annot_id</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">nb_annot</span> <span class="ow">in</span> <span class="n">description_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">ViSiAnnoT</span><span class="o">.</span><span class="n">removeItemInWidgets</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">,</span> <span class="n">description_dict</span><span class="p">[</span><span class="n">nb_annot</span><span class="p">]</span>
                <span class="p">)</span>

                <span class="k">del</span> <span class="n">description_dict</span><span class="p">[</span><span class="n">nb_annot</span><span class="p">]</span>

        <span class="c1"># if display mode is on, remove the deleted annotation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;On&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removeRegionInWidgets</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">region_annotation_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">][</span><span class="n">annot_id</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_annotation_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">][</span><span class="n">annot_id</span><span class="p">]</span></div>


<div class="viewcode-block" id="ViSiAnnoT.annotEventShow"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.annotEventShow">[docs]</a>    <span class="k">def</span> <span class="nf">annotEventShow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mananges the display of events annotation (on/off)</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># if display mode is off, put it on</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Off&quot;</span><span class="p">:</span>
            <span class="c1"># notify that display mode is now on</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;On&quot;</span><span class="p">)</span>

            <span class="c1"># display regions from the annotation file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotAnnotEventRegions</span><span class="p">()</span>

        <span class="c1"># display mode is on, put it off</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clearAnnotEventRegions</span><span class="p">()</span>

            <span class="c1"># notify that display mode is now off</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Off&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.annotEventCallPushButton"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.annotEventCallPushButton">[docs]</a>    <span class="k">def</span> <span class="nf">annotEventCallPushButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method managing events annotation with push buttons</span>

<span class="sd">        Connected to the signal ``buttonClicked[int]`` of the attribute</span>
<span class="sd">        attr:`.annotevent_button_group_push`.</span>

<span class="sd">        There are 5 buttons and they have an effect on the current label:</span>

<span class="sd">        - ``button_id == 0``: set annotation beginning datetime at the current</span>
<span class="sd">          frame :attr:`.frame_id`</span>
<span class="sd">        - ``button_id == 1``: set annotation ending datetime with the current</span>
<span class="sd">          frame :attr;`.frame_id`</span>
<span class="sd">        - ``button_id == 2``: add annotation defined by the current beginning</span>
<span class="sd">          and ending datetimes</span>
<span class="sd">        - ``button_id == 3``: delete last annotation</span>
<span class="sd">        - ``button_id == 4``: on/off display</span>

<span class="sd">        :param button_id: index of the button that has been pushed</span>
<span class="sd">        :type button_id: int</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># set beginning time of the annotated interval</span>
        <span class="k">if</span> <span class="n">button_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotEventSetTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># set ending time of the annotated interval</span>
        <span class="k">elif</span> <span class="n">button_id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotEventSetTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># add the annotated interval to the annotation file</span>
        <span class="k">elif</span> <span class="n">button_id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotEventAdd</span><span class="p">()</span>

        <span class="c1"># delete last annotation</span>
        <span class="k">elif</span> <span class="n">button_id</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># check if annotation file exists and annotation file is not empty</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_path_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> \
                    <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotEventDelete</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot delete annotation since annotation file does not exist or is empty.&quot;</span><span class="p">)</span>

        <span class="c1"># display the annotated intervals</span>
        <span class="k">elif</span> <span class="n">button_id</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotEventShow</span><span class="p">()</span></div>


<div class="viewcode-block" id="ViSiAnnoT.plotAnnotEventRegions"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.plotAnnotEventRegions">[docs]</a>    <span class="k">def</span> <span class="nf">plotAnnotEventRegions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots events annotations, either only for the current label, or for all</span>
<span class="sd">        lables (depending on the check box &quot;Display all labels&quot;)</span>

<span class="sd">        Make sure that the attribute :attr:`.region_annotation_dict`</span>
<span class="sd">        is already created.</span>

<span class="sd">        It checks if the display mode is on before plotting.</span>

<span class="sd">        Connected to the signal ``buttonClicked`` of</span>
<span class="sd">        :attr:`.annotevent_button_group_radio_disp` and</span>
<span class="sd">        :attr:`.annotevent_button_group_check_custom`.</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check if display mode is on</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;On&quot;</span><span class="p">:</span>
            <span class="c1"># get display mode</span>
            <span class="n">button_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_group_radio_disp</span><span class="o">.</span><span class="n">checkedId</span><span class="p">()</span>

            <span class="c1"># display current label</span>
            <span class="k">if</span> <span class="n">button_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plot_dict</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_color_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_current_label_id</span><span class="p">]</span>
                <span class="p">}</span>

            <span class="c1"># display all labels</span>
            <span class="k">elif</span> <span class="n">button_id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">plot_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">label_id</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_color_list</span><span class="p">):</span>
                    <span class="n">plot_dict</span><span class="p">[</span><span class="n">label_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>

            <span class="c1"># display custom</span>
            <span class="k">elif</span> <span class="n">button_id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">plot_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">label_id</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_color_list</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_group_check_custom</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">label_id</span><span class="p">)</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="n">plot_dict</span><span class="p">[</span><span class="n">label_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>

            <span class="c1"># loop on labels already plotted</span>
            <span class="n">label_id_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">region_annotation_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">label_id</span> <span class="ow">in</span> <span class="n">label_id_list</span><span class="p">:</span>
                <span class="c1"># if label not to be plotted anymore</span>
                <span class="k">if</span> <span class="n">label_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="c1"># clear display</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">clearAnnotEventRegionsSingleLabel</span><span class="p">(</span><span class="n">label_id</span><span class="p">)</span>

            <span class="c1"># loop on labels to plot</span>
            <span class="k">for</span> <span class="n">label_id</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">plot_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># check if label not already displayed</span>
                <span class="k">if</span> <span class="n">label_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_annotation_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="c1"># get annotation path</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_label_list</span><span class="p">[</span><span class="n">label_id</span><span class="p">]</span>
                    <span class="n">annot_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotEventGetPathList</span><span class="p">(</span><span class="n">label</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="c1"># initialize list of region items for the label</span>
                    <span class="n">region_annotation_list</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="c1"># check if annotation file exists</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">annot_path</span><span class="p">):</span>
                        <span class="c1"># read annotation file</span>
                        <span class="n">lines</span> <span class="o">=</span> <span class="n">ToolsData</span><span class="o">.</span><span class="n">getTxtLines</span><span class="p">(</span><span class="n">annot_path</span><span class="p">)</span>

                        <span class="c1"># loop on annotations</span>
                        <span class="k">for</span> <span class="n">annot_line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                            <span class="c1"># display region</span>
                            <span class="n">annot_line_content</span> <span class="o">=</span> <span class="n">annot_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; - &#39;</span><span class="p">)</span>

                            <span class="n">region_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotEventAddRegion</span><span class="p">(</span>
                                <span class="n">annot_line_content</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">annot_line_content</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                                <span class="n">color</span><span class="o">=</span><span class="n">color</span>
                            <span class="p">)</span>

                            <span class="c1"># append list of region items for the label</span>
                            <span class="n">region_annotation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region_list</span><span class="p">)</span>

                    <span class="c1"># update dictionary of region items</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">region_annotation_dict</span><span class="p">[</span><span class="n">label_id</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="n">region_annotation_list</span>

                    <span class="c1"># display annotations description</span>
                    <span class="k">if</span> <span class="n">label_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_description_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">for</span> <span class="n">description_list</span> <span class="ow">in</span> \
                                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_description_dict</span><span class="p">[</span><span class="n">label_id</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">addItemToSignals</span><span class="p">(</span><span class="n">description_list</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.clearAnnotEventRegions"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.clearAnnotEventRegions">[docs]</a>    <span class="k">def</span> <span class="nf">clearAnnotEventRegions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears the display of events annotation for all labels (but does not</span>
<span class="sd">        delete the annotations)</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># loop on labels</span>
        <span class="k">for</span> <span class="n">label_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_label_list</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clearAnnotEventRegionsSingleLabel</span><span class="p">(</span><span class="n">label_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.clearAnnotEventRegionsSingleLabel"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.clearAnnotEventRegionsSingleLabel">[docs]</a>    <span class="k">def</span> <span class="nf">clearAnnotEventRegionsSingleLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears the display of events annotation for a specific label</span>

<span class="sd">        :param label_id: index of the label in the list</span>
<span class="sd">            :attr:`.ViSiAnnoT.annotevent_label_list`</span>
<span class="sd">        :type label_id: int</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># clear annotations display</span>
        <span class="k">if</span> <span class="n">label_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_annotation_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">region_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_annotation_dict</span><span class="p">[</span><span class="n">label_id</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">removeRegionInWidgets</span><span class="p">(</span><span class="n">region_list</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_annotation_dict</span><span class="p">[</span><span class="n">label_id</span><span class="p">]</span>

        <span class="c1"># clear descriptions display</span>
        <span class="k">if</span> <span class="n">label_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_description_dict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">description_list</span> <span class="ow">in</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_description_dict</span><span class="p">[</span><span class="n">label_id</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">ViSiAnnoT</span><span class="o">.</span><span class="n">removeItemInWidgets</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">,</span> <span class="n">description_list</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.clearAllAnnotEventDescriptions"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.clearAllAnnotEventDescriptions">[docs]</a>    <span class="k">def</span> <span class="nf">clearAllAnnotEventDescriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears the display of all the descriptions of events annotation</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">description_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_description_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">description_list</span> <span class="ow">in</span> <span class="n">description_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">ViSiAnnoT</span><span class="o">.</span><span class="n">removeItemInWidgets</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">,</span> <span class="n">description_list</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_description_dict</span> <span class="o">=</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="ViSiAnnoT.annotEventAddRegion"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.annotEventAddRegion">[docs]</a>    <span class="k">def</span> <span class="nf">annotEventAddRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bound_1</span><span class="p">,</span> <span class="n">bound_2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays a region in the progress bar and the signal widgets</span>

<span class="sd">        It converts the bounds to frame numbers and then calls the</span>
<span class="sd">        method :meth:`.ViSiAnnoT.addRegionToWidgets`.</span>

<span class="sd">        :param bound_1: start datetime of the region</span>
<span class="sd">        :type bound_1: str</span>
<span class="sd">        :param bound_2: end datetime of the region</span>
<span class="sd">        :type bound_2: str</span>
<span class="sd">        :param kwargs: keyword arguments of</span>
<span class="sd">            :meth:`.ViSiAnnoT.addRegionToWidgets`</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># convert bounds to frame numbers</span>
        <span class="n">frame_1</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertAbsoluteDatetimeStringToFrame</span><span class="p">(</span>
            <span class="n">bound_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span><span class="p">,</span>
            <span class="n">time_zone</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_zone</span>
        <span class="p">)</span>

        <span class="n">frame_2</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertAbsoluteDatetimeStringToFrame</span><span class="p">(</span>
            <span class="n">bound_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span><span class="p">,</span>
            <span class="n">time_zone</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_zone</span>
        <span class="p">)</span>

        <span class="c1"># check date-time (useful for longRec)</span>
        <span class="k">if</span> <span class="n">frame_1</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">frame_1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> \
            <span class="ow">or</span> <span class="n">frame_2</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">frame_2</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> \
                <span class="ow">or</span> <span class="n">frame_1</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">frame_2</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span><span class="p">:</span>
            <span class="c1"># display region in each signal plot</span>
            <span class="n">region_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addRegionToWidgets</span><span class="p">(</span><span class="n">frame_1</span><span class="p">,</span> <span class="n">frame_2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">region_list</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span></div>


    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># End group</span>
    <span class="c1"># *********************************************************************** #</span>

    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># Group: Callback methods for fast navigation</span>
    <span class="c1"># *********************************************************************** #</span>


<div class="viewcode-block" id="ViSiAnnoT.callComboTrunc"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.callComboTrunc">[docs]</a>    <span class="k">def</span> <span class="nf">callComboTrunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ite_trunc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method for selecting a part of the video/signal defined by</span>
<span class="sd">        :attr:`.trunc_duration` via the combo box</span>
<span class="sd">        :attr:`.combo_trunc`</span>

<span class="sd">        Connected to the signal ``currentIndexChanged`` of</span>
<span class="sd">        :attr:`.combo_trunc`.</span>

<span class="sd">        It sets the temporal range (:attr:`.first_frame` and</span>
<span class="sd">        :attr:`.last_frame`) with the selected value in the combo</span>
<span class="sd">        box. The current frame :attr:`.frame_id` is set to the new</span>
<span class="sd">        :attr:`.first_frame`. Then it calls the method</span>
<span class="sd">        :meth:`.updateSignalPlot`.</span>

<span class="sd">        :param ite_trunc: index of the selected value in the combo box</span>
<span class="sd">            :attr:`.combo_trunc`</span>
<span class="sd">        :type ite_trunc: int</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check if the value selected in the combo box is not the first one</span>
        <span class="c1"># (empty one)</span>
        <span class="k">if</span> <span class="n">ite_trunc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># define new range</span>
            <span class="n">ite_trunc</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">=</span> <span class="n">ite_trunc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes_trunc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">ite_trunc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes_trunc</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span><span class="p">)</span>

            <span class="c1"># update plots signals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateSignalPlot</span><span class="p">(</span><span class="n">flag_reset_combo_trunc</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># update frame id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="n">ite_trunc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes_trunc</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.callComboFromCursor"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.callComboFromCursor">[docs]</a>    <span class="k">def</span> <span class="nf">callComboFromCursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ite_combo</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method for selecting a pre-defined temporal range that begins</span>
<span class="sd">        at the current temporal cursor position</span>

<span class="sd">        Connected to the signal ``currentIndexChanged`` of the attribute</span>
<span class="sd">        :attr:`.combo_from_cursor`.</span>

<span class="sd">        It sets :attr:`.first_frame` to :attr:`.frame_id`</span>
<span class="sd">        and :attr:`.last_frame` so that the temporal range spans the</span>
<span class="sd">        selected value of the combo box :attr:`.combo_from_cursor`.</span>
<span class="sd">        Then it calls the method :meth:`.updateSignalPlot`.</span>

<span class="sd">        :param ite_combo: index of the selected value in the combo box</span>
<span class="sd">            :attr:`.combo_from_cursor`</span>
<span class="sd">        :type ite_combo: int</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check if the value selected in the combo box is not empty</span>
        <span class="k">if</span> <span class="n">ite_combo</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># get the value of the combo box and convert it to frame number</span>
            <span class="n">ite_combo</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">frame_interval</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertTimeToFrame</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">from_cursor_list</span><span class="p">[</span><span class="n">ite_combo</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">from_cursor_list</span><span class="p">[</span><span class="n">ite_combo</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># define new range</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">+</span> <span class="n">frame_interval</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span><span class="p">)</span>

            <span class="c1"># update plots signals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateSignalPlot</span><span class="p">(</span><span class="n">flag_reset_combo_from_cursor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.timeEditCurrent"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.timeEditCurrent">[docs]</a>    <span class="k">def</span> <span class="nf">timeEditCurrent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method to set :attr:`.ViSiAnnoT.edit_start` to the current</span>
<span class="sd">        frame :attr:`.ViSiAnnoT.frame_id`</span>

<span class="sd">        Connected to the signal ``clicked`` of :attr:`.ViSiAnnoT.current_push`.</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">current_datetime</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertFrameToAbsoluteDatetime</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edit_start</span><span class="o">.</span><span class="n">setDate</span><span class="p">(</span>
            <span class="n">QtCore</span><span class="o">.</span><span class="n">QDate</span><span class="p">(</span><span class="n">current_datetime</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                         <span class="n">current_datetime</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                         <span class="n">current_datetime</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edit_start</span><span class="o">.</span><span class="n">setTime</span><span class="p">(</span>
            <span class="n">QtCore</span><span class="o">.</span><span class="n">QTime</span><span class="p">(</span><span class="n">current_datetime</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
                         <span class="n">current_datetime</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
                         <span class="n">current_datetime</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.timeEditOk"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.timeEditOk">[docs]</a>    <span class="k">def</span> <span class="nf">timeEditOk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method to set the temporal range</span>
<span class="sd">        (:attr:`.first_frame` and :attr:`.last_frame`) to</span>
<span class="sd">        the custom temporal range (manually defined with</span>
<span class="sd">        :attr:`.edit_duration` and :attr:`.edit_start`)</span>

<span class="sd">        If :attr:`.edit_duration` is 0, then the current temporal</span>
<span class="sd">        range duration is kept.</span>

<span class="sd">        Connected to the signal ``clicked`` of</span>
<span class="sd">        :attr:`.time_edit_push`.</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get duration time edit</span>
        <span class="n">duration_qtime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_duration</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">duration_hour</span> <span class="o">=</span> <span class="n">duration_qtime</span><span class="o">.</span><span class="n">hour</span><span class="p">()</span>
        <span class="n">duration_minute</span> <span class="o">=</span> <span class="n">duration_qtime</span><span class="o">.</span><span class="n">minute</span><span class="p">()</span>
        <span class="n">duration_sec</span> <span class="o">=</span> <span class="n">duration_qtime</span><span class="o">.</span><span class="n">second</span><span class="p">()</span>

        <span class="c1"># check duration</span>
        <span class="k">if</span> <span class="n">duration_hour</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">duration_minute</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">duration_sec</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">duration_hour</span><span class="p">,</span> <span class="n">duration_minute</span><span class="p">,</span> <span class="n">duration_sec</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> \
                <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertFrameToTime</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span>
                <span class="p">)</span>

        <span class="c1"># get start date-time</span>
        <span class="n">start_qdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_start</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="n">start_qtime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_start</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">start_date_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span>
            <span class="n">start_qdate</span><span class="o">.</span><span class="n">year</span><span class="p">(),</span> <span class="n">start_qdate</span><span class="o">.</span><span class="n">month</span><span class="p">(),</span> <span class="n">start_qdate</span><span class="o">.</span><span class="n">day</span><span class="p">(),</span>
            <span class="n">start_qtime</span><span class="o">.</span><span class="n">hour</span><span class="p">(),</span> <span class="n">start_qtime</span><span class="o">.</span><span class="n">minute</span><span class="p">(),</span> <span class="n">start_qtime</span><span class="o">.</span><span class="n">second</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">pst</span> <span class="o">=</span> <span class="n">timezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_zone</span><span class="p">)</span>
        <span class="n">start_date_time</span> <span class="o">=</span> <span class="n">pst</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">start_date_time</span><span class="p">)</span>

        <span class="c1"># get start frame</span>
        <span class="n">start_frame</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertAbsoluteDatetimeToFrame</span><span class="p">(</span>
            <span class="n">start_date_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span>
        <span class="p">)</span>

        <span class="c1"># check temporal coherence</span>
        <span class="n">coherence</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">start_frame</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">start_frame</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span><span class="p">:</span>
            <span class="c1"># check long recordings</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_long_rec</span><span class="p">:</span>
                <span class="c1"># get recording id</span>
                <span class="n">start_rec_diff_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[(</span><span class="n">beg_rec</span> <span class="o">-</span> <span class="n">start_date_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">beg_rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec_beginning_datetime_list</span><span class="p">]</span>
                <span class="p">)</span>

                <span class="n">new_rec_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">start_rec_diff_array</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">new_rec_id</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">coherence</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;wrong input: start time is above the ending of the recordings&quot;</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">new_rec_id</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">start_rec_diff_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">coherence</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;wrong input: start time is below the beginning of the recording&quot;</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># change recording</span>
                    <span class="n">new_rec_id</span> <span class="o">=</span> <span class="n">new_rec_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">coherence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepareNewRecording</span><span class="p">(</span><span class="n">new_rec_id</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;wrong input: start time is below the beginning of the recordings or above the ending of the recording&quot;</span><span class="p">)</span>
                <span class="n">coherence</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># go for it</span>
        <span class="k">if</span> <span class="n">coherence</span><span class="p">:</span>
            <span class="c1"># define new range</span>
            <span class="n">start_frame</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertAbsoluteDatetimeToFrame</span><span class="p">(</span>
                <span class="n">start_date_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">=</span> <span class="n">start_frame</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span> <span class="o">+</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">convertTimeToFrame</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> <span class="n">duration_hour</span><span class="p">,</span> <span class="n">duration_minute</span><span class="p">,</span> <span class="n">duration_sec</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="c1"># udpdate current frame</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="n">start_frame</span><span class="p">)</span>

            <span class="c1"># update signals plots</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateSignalPlot</span><span class="p">()</span>

            <span class="c1"># update annotation regions plot</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_label_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clearAnnotEventRegions</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotAnnotEventRegions</span><span class="p">()</span></div>


    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># End group</span>
    <span class="c1"># *********************************************************************** #</span>

    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># Group: Callback method for key press interaction</span>
    <span class="c1"># *********************************************************************** #</span>


<div class="viewcode-block" id="ViSiAnnoT.keyPress"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.keyPress">[docs]</a>    <span class="k">def</span> <span class="nf">keyPress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method for key press interaction</span>

<span class="sd">        - **Space**: play/pause video playback</span>
<span class="sd">        - **Left**: rewind 1 second (1 minute if **ctrl** key pressed as well)</span>
<span class="sd">        - **Right**: forward 1 second (1 minute if **ctrl** key pressed as</span>
<span class="sd">          well)</span>
<span class="sd">        - **Down**: rewind 10 seconds (10 minutes if **ctrl** key pressed as</span>
<span class="sd">          well)</span>
<span class="sd">        - **Up**: forward 10 seconds (10 minutes if **ctrl** key pressed as</span>
<span class="sd">          well)</span>
<span class="sd">        - **l**: rewind 1 frame</span>
<span class="sd">        - **m**: forward 1 frame</span>
<span class="sd">        - **Home**: set the current frame :attr:`.ViSiAnnoT.frame_id` to 0</span>
<span class="sd">        - **End**: set the current frame :attr:`.ViSiAnnoT.frame_id` to</span>
<span class="sd">          ``ViSiAnnoT.nframes-1``</span>
<span class="sd">        - **i**: zoom in (:meth:`.ViSiAnnoT.zoomIn` is called)</span>
<span class="sd">        - **o**: zoom out (:meth:`.ViSiAnnoT.zoomOut` is called)</span>
<span class="sd">        - **n**: set the temporal range to the fullest</span>
<span class="sd">        - **a**: define start datetime of events annotation</span>
<span class="sd">        - **z**: define end datetime of events annotation</span>
<span class="sd">        - **e**: add events annotation</span>
<span class="sd">        - **s**: display events annotations</span>
<span class="sd">        - **Page down**: load previous file in case of long recordings</span>
<span class="sd">          (:attr:`.ViSiAnnoT.flag_long_rec` is ``True``)</span>
<span class="sd">        - **Page up**: load next file in case of long recordings</span>
<span class="sd">          (:attr:`.ViSiAnnoT.flag_long_rec` is ``True``)</span>
<span class="sd">        - **d** + **ctrl** + **shift**: clear the display of all events</span>
<span class="sd">          annotation descriptions</span>

<span class="sd">        :param ev: emmited when a key is pressed</span>
<span class="sd">        :type ev: QtGui.QKeyEvent</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">keyboard_modifiers</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">modifiers</span><span class="p">()</span>

        <span class="c1"># get pressed key</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">key</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Space</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flag_pause_status</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_pause_status</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Left</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">keyboard_modifiers</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">-</span> <span class="mi">60</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Right</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">keyboard_modifiers</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec_nb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nframes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Down</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">keyboard_modifiers</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">-</span> <span class="mi">600</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Up</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">keyboard_modifiers</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">+</span> <span class="mi">600</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec_nb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nframes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_L</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_M</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec_nb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nframes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_I</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zoomIn</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_O</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zoomOut</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_N</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wid_data_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visiAll</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_A</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_label_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotEventSetTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Z</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_label_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotEventSetTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_E</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_label_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotEventAdd</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_S</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_label_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotEventShow</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_PageDown</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_long_rec</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeFileInLongRec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec_id</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_PageUp</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_long_rec</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeFileInLongRec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Home</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_End</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateFrameId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_D</span> <span class="ow">and</span> <span class="n">keyboard_modifiers</span> <span class="o">==</span> \
                <span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ShiftModifier</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clearAllAnnotEventDescriptions</span><span class="p">()</span></div>


<div class="viewcode-block" id="ViSiAnnoT.keyRelease"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.keyRelease">[docs]</a>    <span class="k">def</span> <span class="nf">keyRelease</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method for key release interaction</span>

<span class="sd">        - **Alt**: show/hide menu bar</span>

<span class="sd">        :param ev: emmited when a key is released</span>
<span class="sd">        :type ev: QtGui.QKeyEvent</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get released key</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">key</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Alt</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu_bar</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">menu_bar</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">menu_bar</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># End group</span>
    <span class="c1"># *********************************************************************** #</span>

    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># Group: Methods for creating widgets</span>
    <span class="c1"># *********************************************************************** #</span>


<div class="viewcode-block" id="ViSiAnnoT.createWidgetTimeEdit"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.createWidgetTimeEdit">[docs]</a>    <span class="k">def</span> <span class="nf">createWidgetTimeEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget_position</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a widget for defining a custom temporal interval and adds it to</span>
<span class="sd">        the layout :attr:`.ViSiAnnoT.lay`</span>

<span class="sd">        A group box is added to the layout and the combo box is added to the</span>
<span class="sd">        group box.</span>

<span class="sd">        It sets the following attributes:</span>

<span class="sd">        - :attr:`.edit_start`</span>
<span class="sd">        - :attr:`.current_push`</span>
<span class="sd">        - :attr:`.edit_duration`</span>
<span class="sd">        - :attr:`.time_edit_push`</span>

<span class="sd">        :param widget_position: position of the widget in the layout, length 2</span>
<span class="sd">            ``(row, col)`` or 4 ``(row, col, rowspan, colspan)``</span>
<span class="sd">        :type widget_position: list or tuple</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># create group box</span>
        <span class="n">grid</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ToolsPyQt</span><span class="o">.</span><span class="n">addGroupBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lay</span><span class="p">,</span>
                                        <span class="n">widget_position</span><span class="p">,</span>
                                        <span class="s2">&quot;Custom temporal range&quot;</span><span class="p">)</span>

        <span class="c1"># add qlabel</span>
        <span class="n">q_label</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Start date-time&quot;</span><span class="p">)</span>
        <span class="n">q_label</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">q_label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edit_start</span><span class="o">.</span><span class="n">setDisplayFormat</span><span class="p">(</span><span class="s2">&quot;yyyy-MM-dd - hh:mm:ss&quot;</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edit_start</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># add push button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_push</span> <span class="o">=</span> <span class="n">ToolsPyQt</span><span class="o">.</span><span class="n">addPushButton</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;Current&quot;</span><span class="p">)</span>

        <span class="c1"># add qlabel</span>
        <span class="n">q_label</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Temporal range duration&quot;</span><span class="p">)</span>
        <span class="n">q_label</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">q_label</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># add time edit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edit_duration</span><span class="o">.</span><span class="n">setDisplayFormat</span><span class="p">(</span><span class="s2">&quot;hh:mm:ss&quot;</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edit_duration</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># add push button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_edit_push</span> <span class="o">=</span> <span class="n">ToolsPyQt</span><span class="o">.</span><span class="n">addPushButton</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;Ok&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.createWidgetProgress"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.createWidgetProgress">[docs]</a>    <span class="k">def</span> <span class="nf">createWidgetProgress</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">widget_position</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">title_style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#000&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="s1">&#39;9pt&#39;</span><span class="p">},</span>
        <span class="n">ticks_color</span><span class="o">=</span><span class="s2">&quot;#000&quot;</span><span class="p">,</span> <span class="n">ticks_size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">ticks_offset</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a widget with the progress bar and adds it to the layout</span>
<span class="sd">        :attr:`.ViSiAnnoT.lay`</span>

<span class="sd">        It sets the attribute :attr:`.wid_progress`.</span>

<span class="sd">        :param widget_position: position of the widget in the layout, length 2</span>
<span class="sd">            ``(row, col)`` or 4 ``(row, col, rowspan, colspan)``</span>
<span class="sd">        :type widget_position: list or tuple</span>
<span class="sd">        :param title: widget title</span>
<span class="sd">        :type title: str</span>
<span class="sd">        :param title_style: widget title style</span>
<span class="sd">        :type title_style: dict</span>
<span class="sd">        :param ticks_color: color of the ticks text, may be HEX string or</span>
<span class="sd">            (RGB)</span>
<span class="sd">        :type ticks_color: str or tuple or list</span>
<span class="sd">        :param ticks_size: font size of the ticks text in pt</span>
<span class="sd">        :type ticks_size: float</span>
<span class="sd">        :param ticks_offset: ticks text offset</span>
<span class="sd">        :type ticks_offset: int</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># create widget containing the progress bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wid_progress</span> <span class="o">=</span> <span class="n">ToolsPyqtgraph</span><span class="o">.</span><span class="n">ProgressWidget</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">title_style</span><span class="o">=</span><span class="n">title_style</span><span class="p">,</span>
            <span class="n">ticks_color</span><span class="o">=</span><span class="n">ticks_color</span><span class="p">,</span> <span class="n">ticks_size</span><span class="o">=</span><span class="n">ticks_size</span><span class="p">,</span>
            <span class="n">ticks_offset</span><span class="o">=</span><span class="n">ticks_offset</span>
        <span class="p">)</span>

        <span class="c1"># add the widget to the layout</span>
        <span class="n">ToolsPyQt</span><span class="o">.</span><span class="n">addWidgetToLayout</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wid_progress</span><span class="p">,</span> <span class="n">widget_position</span>
        <span class="p">)</span>

        <span class="c1"># set widget height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wid_progress</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>

        <span class="c1"># set temporal ticks and X axis range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTemporalTicks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wid_progress</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">))</span>

        <span class="c1"># set boundaries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wid_progress</span><span class="o">.</span><span class="n">getFirstLine</span><span class="p">()</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_frame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wid_progress</span><span class="o">.</span><span class="n">getLastLine</span><span class="p">()</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_frame</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># print current frame id and current temporal width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateProgressBarTitle</span><span class="p">()</span></div>


<div class="viewcode-block" id="ViSiAnnoT.createWidgetAnnotEvent"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.createWidgetAnnotEvent">[docs]</a>    <span class="k">def</span> <span class="nf">createWidgetAnnotEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget_position</span><span class="p">,</span> <span class="n">nb_table</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a widget with the events annotation tool and adds it to the</span>
<span class="sd">        layout :attr:`.ViSiAnnoT.lay`</span>

<span class="sd">        Make sure the attribute :attr:`.annotevent_label_list` is</span>
<span class="sd">        defined before calling this method.</span>

<span class="sd">        It sets the following attributes:</span>

<span class="sd">        - :attr:`.annotevent_button_group_radio_label`</span>
<span class="sd">        - :attr:`.annotevent_button_group_push` (must be initialized)</span>
<span class="sd">        - :attr:`.annotevent_button_label_list` (must be initialized)</span>
<span class="sd">        - :attr:`.annotevent_button_group_radio_disp`</span>
<span class="sd">        - :attr:`.annotevent_button_group_check_custom`</span>

<span class="sd">        :param widget_position: position of the widget in the layout, length 2</span>
<span class="sd">            ``(row, col)`` or 4 ``(row, col, rowspan, colspan)``</span>
<span class="sd">        :type widget_position: list or tuple</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># create group box</span>
        <span class="n">grid</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ToolsPyQt</span><span class="o">.</span><span class="n">addGroupBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lay</span><span class="p">,</span> <span class="n">widget_position</span><span class="p">,</span>
                                        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Events annotation&quot;</span><span class="p">)</span>

        <span class="c1"># create widget with radio buttons (annotation labels)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_group_radio_label</span> <span class="o">=</span> \
            <span class="n">ToolsPyQt</span><span class="o">.</span><span class="n">addWidgetButtonGroup</span><span class="p">(</span>
                <span class="n">grid</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_label_list</span><span class="p">,</span>
                <span class="n">color_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_color_list</span><span class="p">,</span>
                <span class="n">box_title</span><span class="o">=</span><span class="s2">&quot;Current label selection&quot;</span><span class="p">,</span>
                <span class="n">nb_table</span><span class="o">=</span><span class="n">nb_table</span>
            <span class="p">)</span>

        <span class="c1"># get number of annotations already stored (default first label)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_path_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">ToolsData</span><span class="o">.</span><span class="n">getTxtLines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_path_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">nb_annot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nb_annot</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># create push buttons with a label next to it</span>
        <span class="n">button_text_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="s2">&quot;Stop&quot;</span><span class="p">,</span> <span class="s2">&quot;Add&quot;</span><span class="p">,</span> <span class="s2">&quot;Delete last&quot;</span><span class="p">,</span> <span class="s2">&quot;Display&quot;</span><span class="p">]</span>
        <span class="n">button_label_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;YYYY-MM-DD hh:mm:ss.sss&quot;</span><span class="p">,</span>
            <span class="s2">&quot;YYYY-MM-DD hh:mm:ss.sss&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Nb: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">nb_annot</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;On&quot;</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">ite_button</span><span class="p">,</span> <span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
            <span class="n">button_text_list</span><span class="p">,</span> <span class="n">button_label_list</span>
        <span class="p">)):</span>
            <span class="c1"># add push button</span>
            <span class="n">push_button</span> <span class="o">=</span> <span class="n">ToolsPyQt</span><span class="o">.</span><span class="n">addPushButton</span><span class="p">(</span>
                <span class="n">grid</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">ite_button</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">text</span><span class="p">,</span>
                <span class="n">flag_enable_key_interaction</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>

            <span class="c1"># add push button to group for push buttons</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_group_push</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span>
                <span class="n">push_button</span><span class="p">,</span> <span class="n">ite_button</span>
            <span class="p">)</span>

            <span class="c1"># add label next to the push button</span>
            <span class="k">if</span> <span class="n">label</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">q_label</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                <span class="n">q_label</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignVCenter</span><span class="p">)</span>
                <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">q_label</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ite_button</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q_label</span><span class="p">)</span>

        <span class="c1"># create widget with radio buttons (display options)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_group_radio_disp</span> <span class="o">=</span> \
            <span class="n">ToolsPyQt</span><span class="o">.</span><span class="n">addWidgetButtonGroup</span><span class="p">(</span>
                <span class="n">grid</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ite_button</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">[</span><span class="s2">&quot;Current label&quot;</span><span class="p">,</span> <span class="s2">&quot;All labels&quot;</span><span class="p">,</span> <span class="s2">&quot;Custom (below)&quot;</span><span class="p">],</span>
                <span class="n">box_title</span><span class="o">=</span><span class="s2">&quot;Display mode&quot;</span>
            <span class="p">)</span>

        <span class="c1"># create check boxes with labels</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_button_group_check_custom</span> <span class="o">=</span> \
            <span class="n">ToolsPyQt</span><span class="o">.</span><span class="n">addWidgetButtonGroup</span><span class="p">(</span>
                <span class="n">grid</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="n">ite_button</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotevent_label_list</span><span class="p">,</span>
                <span class="n">color_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">annotevent_color_list</span><span class="p">,</span>
                <span class="n">box_title</span><span class="o">=</span><span class="s2">&quot;Custom display&quot;</span><span class="p">,</span>
                <span class="n">button_type</span><span class="o">=</span><span class="s2">&quot;check_box&quot;</span><span class="p">,</span>
                <span class="n">nb_table</span><span class="o">=</span><span class="n">nb_table</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.createWidgetAnnotImage"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.createWidgetAnnotImage">[docs]</a>    <span class="k">def</span> <span class="nf">createWidgetAnnotImage</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">widget_position</span><span class="p">,</span> <span class="n">flag_horizontal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nb_table</span><span class="o">=</span><span class="mi">5</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a widget with the image annotation tool and adds to the layout</span>
<span class="sd">        :attr:`.ViSiAnnoT.lay`</span>

<span class="sd">        Make sure the attribute :attr:`.annotimage_label_list` is</span>
<span class="sd">        defined before calling this method.</span>

<span class="sd">        It sets the following attributes:</span>

<span class="sd">        - :attr:`.annotimage_radio_button_group`</span>
<span class="sd">        - :attr:`.annotimage_push_button`</span>

<span class="sd">        :param widget_position: position of the widget in the layout, length 2</span>
<span class="sd">            ``(row, col)`` or 4 ``(row, col, rowspan, colspan)``</span>
<span class="sd">        :type widget_position: list or tuple</span>
<span class="sd">        :param flag_horizontal: specify if radio buttons are horizontal</span>
<span class="sd">        :type flag_horizontal: bool</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># create widget with radio buttons (annotation labels)</span>
        <span class="n">grid</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotimage_radio_button_group</span> <span class="o">=</span> \
            <span class="n">ToolsPyQt</span><span class="o">.</span><span class="n">addWidgetButtonGroup</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lay</span><span class="p">,</span> <span class="n">widget_position</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotimage_label_list</span><span class="p">,</span>
                <span class="n">button_type</span><span class="o">=</span><span class="s2">&quot;radio&quot;</span><span class="p">,</span>
                <span class="n">box_title</span><span class="o">=</span><span class="s2">&quot;Image extraction&quot;</span><span class="p">,</span>
                <span class="n">flag_horizontal</span><span class="o">=</span><span class="n">flag_horizontal</span><span class="p">,</span>
                <span class="n">nb_table</span><span class="o">=</span><span class="n">nb_table</span>
            <span class="p">)</span>

        <span class="c1"># get push button position</span>
        <span class="k">if</span> <span class="n">flag_horizontal</span><span class="p">:</span>
            <span class="n">pos_push_button</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotimage_label_list</span><span class="p">)</span> <span class="o">/</span> <span class="n">nb_table</span><span class="p">),</span> <span class="mi">0</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">pos_push_button</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotimage_label_list</span><span class="p">),</span> <span class="n">nb_table</span><span class="p">),</span> <span class="mi">0</span>
            <span class="p">)</span>

        <span class="c1"># add push button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotimage_push_button</span> <span class="o">=</span> <span class="n">ToolsPyQt</span><span class="o">.</span><span class="n">addPushButton</span><span class="p">(</span>
            <span class="n">grid</span><span class="p">,</span> <span class="n">pos_push_button</span><span class="p">,</span> <span class="s2">&quot;Save&quot;</span><span class="p">,</span> <span class="n">flag_enable_key_interaction</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span></div>


    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># End group</span>
    <span class="c1"># *********************************************************************** #</span>

    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># Group: Methods for setting video and signal data</span>
    <span class="c1"># *********************************************************************** #</span>


<div class="viewcode-block" id="ViSiAnnoT.setAllData"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.setAllData">[docs]</a>    <span class="k">def</span> <span class="nf">setAllData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_dict</span><span class="p">,</span> <span class="n">signal_dict</span><span class="p">,</span> <span class="n">interval_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets video and signal data (to be called before plotting)</span>

<span class="sd">        Make sure the following attributes are defined before calling this</span>
<span class="sd">        method:</span>

<span class="sd">        - :attr:`.plot_style_list`</span>
<span class="sd">        - :attr:`.flag_long_rec`</span>

<span class="sd">        Make sure the follwing attributes are initialized before calling this</span>
<span class="sd">        method (it can be empty):</span>

<span class="sd">        - :attr:`.video_data_dict`</span>
<span class="sd">        - :attr:`.sig_list_list`</span>
<span class="sd">        - :attr:`.interval_dict`</span>

<span class="sd">        Otherwise the video thread throws a RunTime error.</span>
<span class="sd">        These attributes are then set thanks to the positional arguments</span>
<span class="sd">        ``video_dict`` and ``signal_dict``.</span>

<span class="sd">        This method sets the following attributes:</span>

<span class="sd">        - :attr:`.nframes`</span>
<span class="sd">        - :attr:`.ViSiAnnoT.fps`</span>
<span class="sd">        - :attr:`.beginning_datetime`</span>
<span class="sd">        - :attr:`.sig_list_list`</span>
<span class="sd">        - :attr:`.interval_dict`</span>
<span class="sd">        - :attr:`.data_wave`</span>

<span class="sd">        If there is no video, the attributes :attr:`.nframes`,</span>
<span class="sd">        :attr:`.ViSiAnnoT.fps` and :attr:`.beginning_datetime` are</span>
<span class="sd">        set with the first signal in ``signal_dict``.</span>

<span class="sd">        It raises an exception if 2 videos do not have the same FPS or have a</span>
<span class="sd">        temporal shift of more than 1 second.</span>

<span class="sd">        :param video_dict: same as first positional argument of</span>
<span class="sd">            :class:`.ViSiAnnoT` constructor</span>
<span class="sd">        :type video_dict: dict</span>
<span class="sd">        :param signal_dict: same as second positional argument of</span>
<span class="sd">            :class:`.ViSiAnnoT` constructor</span>
<span class="sd">        :type signal_dict: dict</span>
<span class="sd">        :param interval_dict: same as keyword argument of :class:`.ViSiAnnoT`</span>
<span class="sd">            constructor</span>
<span class="sd">        :type interval_dict: dict</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># ******************************************************************* #</span>
        <span class="c1"># **************************** Video ******************************** #</span>
        <span class="c1"># ******************************************************************* #</span>

        <span class="c1"># initialize temporary lists (used in case of several cameras to check</span>
        <span class="c1"># synchronization)</span>
        <span class="n">nframes_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fps_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">beginning_datetime_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># reset attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sig_list_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># loop on video</span>
        <span class="k">for</span> <span class="n">ite</span><span class="p">,</span> <span class="p">(</span><span class="n">video_id</span><span class="p">,</span> <span class="p">(</span><span class="n">path_video</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">fmt</span><span class="p">))</span> <span class="ow">in</span> \
                <span class="nb">enumerate</span><span class="p">(</span><span class="n">video_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="c1"># get data</span>
            <span class="k">if</span> <span class="n">path_video</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">video_data_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">],</span> <span class="n">nframes</span><span class="p">,</span> <span class="n">fps</span> <span class="o">=</span> \
                    <span class="n">ToolsImage</span><span class="o">.</span><span class="n">getDataVideo</span><span class="p">(</span><span class="n">path_video</span><span class="p">)</span>

                <span class="n">beginning_datetime</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">getDatetimeFromPath</span><span class="p">(</span>
                    <span class="n">path_video</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">time_zone</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_zone</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">video_data_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">nframes</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">fps</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">beginning_datetime</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># update lists</span>
            <span class="n">nframes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nframes</span><span class="p">)</span>
            <span class="n">fps_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fps</span><span class="p">)</span>
            <span class="n">beginning_datetime_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">beginning_datetime</span><span class="p">)</span>

            <span class="c1"># check FPS</span>
            <span class="k">if</span> <span class="n">fps</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">path_video</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: video with null FPS at </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">path_video</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">()</span>

        <span class="c1"># check if there is any video</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video_data_dict</span><span class="p">):</span>
            <span class="c1"># make sure that FPS is not null</span>
            <span class="n">flag_ok</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">ite_vid</span><span class="p">,</span> <span class="n">fps</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fps_list</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">fps</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">flag_ok</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="n">flag_ok</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="n">fps_list</span><span class="p">[</span><span class="n">ite_vid</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># get number of frames of the video</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">=</span> <span class="n">nframes_list</span><span class="p">[</span><span class="n">ite_vid</span><span class="p">]</span>

            <span class="c1"># get beginning datetime of the video</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span> <span class="o">=</span> <span class="n">beginning_datetime_list</span><span class="p">[</span><span class="n">ite_vid</span><span class="p">]</span>

        <span class="c1"># check if more than 2 videos</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nframes_list</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># update number of frames</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nframes_list</span><span class="p">)</span>

            <span class="c1"># check coherence</span>
            <span class="k">for</span> <span class="n">fps</span> <span class="ow">in</span> <span class="n">fps_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">!=</span> <span class="n">fps</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">video_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The 2 videos do not have the same FPS. </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">video_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">],</span> <span class="n">path_video</span><span class="p">))</span>


        <span class="c1"># ******************************************************************* #</span>
        <span class="c1"># ************************** No video ******************************* #</span>
        <span class="c1"># ******************************************************************* #</span>

        <span class="c1"># check if there is no video</span>
        <span class="c1"># in this case the attributes fps, nframes and beginning_datetime are</span>
        <span class="c1"># not defined yet =&gt; these attributes are defined with the first signal</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">video_dict</span><span class="p">):</span>
            <span class="c1"># get information about signal</span>
            <span class="n">path</span><span class="p">,</span> <span class="n">key_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> \
                <span class="nb">list</span><span class="p">(</span><span class="n">signal_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># get beginning date-time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beginning_datetime</span> <span class="o">=</span> <span class="n">ToolsDateTime</span><span class="o">.</span><span class="n">getDatetimeFromPath</span><span class="p">(</span>
                <span class="n">path</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">time_zone</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_zone</span>
            <span class="p">)</span>

            <span class="c1"># get data path (in case not synchronized)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_long_rec</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_synchro</span><span class="p">:</span>
                <span class="c1"># get first synchronization file content</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">ToolsData</span><span class="o">.</span><span class="n">getTxtLines</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

                <span class="c1"># get first signal file</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="c1"># check if audio</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.wav&quot;</span><span class="p">:</span>
                <span class="c1"># get fps of audio</span>
                <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="n">ToolsAudio</span><span class="o">.</span><span class="n">getAudioWaveFrequency</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

            <span class="c1"># get data</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">ToolsData</span><span class="o">.</span><span class="n">getDataGeneric</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">key_data</span><span class="p">)</span>

            <span class="c1"># check if there is data indeed</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;There is no data in the first signal file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">path</span>
                <span class="p">)</span>

            <span class="c1"># get number of frames</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


        <span class="c1"># ******************************************************************* #</span>
        <span class="c1"># *************************** Signal ******************************** #</span>
        <span class="c1"># ******************************************************************* #</span>

        <span class="c1"># loop on signals</span>
        <span class="k">for</span> <span class="n">ite_type</span><span class="p">,</span> <span class="p">(</span><span class="n">type_data</span><span class="p">,</span> <span class="n">data_info_list</span><span class="p">)</span> <span class="ow">in</span> \
                <span class="nb">enumerate</span><span class="p">(</span><span class="n">signal_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="c1"># initialize temporary list</span>
            <span class="n">sig_list_tmp</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># loop on sub-signals</span>
            <span class="k">for</span> <span class="n">ite_data</span><span class="p">,</span> <span class="p">(</span><span class="n">path_data</span><span class="p">,</span> <span class="n">key_data</span><span class="p">,</span> <span class="n">freq_data</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">plot_style</span><span class="p">)</span> \
                    <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_info_list</span><span class="p">):</span>
                <span class="c1"># ******************** load intervals *********************** #</span>
                <span class="k">if</span> <span class="n">type_data</span> <span class="ow">in</span> <span class="n">interval_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="c1"># initialize dictionary value</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">interval_dict</span><span class="p">[</span><span class="n">type_data</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="c1"># loop on intervals paths</span>
                    <span class="k">for</span> <span class="n">path_interval</span><span class="p">,</span> <span class="n">key_interval</span><span class="p">,</span> <span class="n">freq_interval</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> \
                            <span class="n">color_interval</span> <span class="ow">in</span> <span class="n">interval_dict</span><span class="p">[</span><span class="n">type_data</span><span class="p">]:</span>
                        <span class="c1"># get frequency if necessary</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">freq_interval</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                            <span class="n">freq_interval</span> <span class="o">=</span> <span class="n">ToolsData</span><span class="o">.</span><span class="n">getAttributeGeneric</span><span class="p">(</span>
                                <span class="n">path_interval</span><span class="p">,</span> <span class="n">freq_interval</span>
                            <span class="p">)</span>

                        <span class="k">elif</span> <span class="n">freq_interval</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">freq_interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span>

                        <span class="c1"># check if file exists</span>
                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path_interval</span><span class="p">):</span>
                            <span class="c1"># asynchronous signal</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_long_rec</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_synchro</span><span class="p">:</span>
                                <span class="c1"># load intervals data</span>
                                <span class="n">interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDataSigTmp</span><span class="p">(</span>
                                    <span class="n">path_interval</span><span class="p">,</span> <span class="n">type_data</span><span class="p">,</span> <span class="n">key_interval</span><span class="p">,</span>
                                    <span class="n">freq_interval</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_delimiter</span>
                                <span class="p">)</span>

                                <span class="c1"># if time series, convert to intervals</span>
                                <span class="k">if</span> <span class="n">interval</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                    <span class="n">interval</span> <span class="o">=</span> \
                                        <span class="n">ToolsData</span><span class="o">.</span><span class="n">convertTimeSeriesToIntervals</span><span class="p">(</span>
                                            <span class="n">interval</span><span class="p">,</span> <span class="mi">1</span>
                                        <span class="p">)</span>

                            <span class="c1"># synchro OK</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># load intervals data</span>
                                <span class="n">interval</span> <span class="o">=</span> <span class="n">ToolsData</span><span class="o">.</span><span class="n">getDataInterval</span><span class="p">(</span>
                                    <span class="n">path_interval</span><span class="p">,</span> <span class="n">key_interval</span>
                                <span class="p">)</span>

                            <span class="c1"># update dictionary value</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">interval_dict</span><span class="p">[</span><span class="n">type_data</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">interval</span><span class="p">,</span> <span class="n">freq_interval</span><span class="p">,</span> <span class="n">color_interval</span><span class="p">]</span>
                            <span class="p">)</span>


                <span class="c1"># ******************** get frequency ************************ #</span>
                <span class="c1"># get frequency if necessary</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path_data</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.wav&quot;</span><span class="p">:</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">freq_data</span> <span class="o">=</span> <span class="n">ToolsAudio</span><span class="o">.</span><span class="n">getAudioWaveFrequency</span><span class="p">(</span><span class="n">path_data</span><span class="p">)</span>

                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">freq_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">freq_data</span> <span class="o">=</span> <span class="n">ToolsData</span><span class="o">.</span><span class="n">getAttributeGeneric</span><span class="p">(</span>
                        <span class="n">path_data</span><span class="p">,</span> <span class="n">freq_data</span>
                    <span class="p">)</span>

                <span class="k">elif</span> <span class="n">freq_data</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">freq_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span>


                <span class="c1"># ********************** load data ************************** #</span>
                <span class="c1"># asynchronous signal</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_long_rec</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_synchro</span><span class="p">:</span>
                    <span class="c1"># get data</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDataSigTmp</span><span class="p">(</span>
                        <span class="n">path_data</span><span class="p">,</span> <span class="n">type_data</span><span class="p">,</span> <span class="n">key_data</span><span class="p">,</span> <span class="n">freq_data</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tmp_delimiter</span>
                    <span class="p">)</span>

                <span class="c1"># synchronous signals</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># keyword arguments for ToolsData.getDataGeneric</span>
                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>

                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path_data</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.wav&quot;</span><span class="p">:</span>
                        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;channel_id&quot;</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">ToolsAudio</span><span class="o">.</span><span class="n">convertKeyToChannelId</span><span class="p">(</span><span class="n">key_data</span><span class="p">)</span>

                    <span class="c1"># load data</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">ToolsData</span><span class="o">.</span><span class="n">getDataGeneric</span><span class="p">(</span>
                        <span class="n">path_data</span><span class="p">,</span> <span class="n">key_data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                    <span class="p">)</span>


                <span class="c1"># ********* convert data into an instance of Signal ********* #</span>
                <span class="c1"># signal plot style</span>
                <span class="k">if</span> <span class="n">plot_style</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">plot_style</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ite_data</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_style_list</span><span class="p">):</span>
                        <span class="n">plot_style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_style_list</span><span class="p">[</span><span class="n">ite_data</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No plot style provided for signal </span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="s2"> (sub-id </span><span class="si">%d</span><span class="s2">) and cannot use the default style.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">type_data</span><span class="p">,</span> <span class="n">key_data</span><span class="p">,</span> <span class="n">ite_data</span><span class="p">))</span>

                <span class="c1"># create an instance of Signal</span>
                <span class="n">signal</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">,</span> <span class="n">freq_data</span><span class="p">,</span> <span class="n">max_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_points</span><span class="p">,</span>
                    <span class="n">plot_style</span><span class="o">=</span><span class="n">plot_style</span><span class="p">,</span> <span class="n">legend_text</span><span class="o">=</span><span class="n">key_data</span>
                <span class="p">)</span>

                <span class="c1"># downsample if necessary</span>
                <span class="k">if</span> <span class="n">freq_data</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">down_freq</span><span class="p">:</span>
                    <span class="n">signal</span><span class="o">.</span><span class="n">downsampleSignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">down_freq</span><span class="p">)</span>

                <span class="c1"># append temporary signal list</span>
                <span class="n">sig_list_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>

            <span class="c1"># append list of signals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sig_list_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sig_list_tmp</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViSiAnnoT.getFileSigTmp"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.getFileSigTmp">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">getFileSigTmp</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the file name and the start second in a line of a temporary</span>
<span class="sd">        synchronization file (in case signal is not synchronized with video)</span>

<span class="sd">        :param line: line containing the signal file name and start second</span>
<span class="sd">        :type line: str</span>
<span class="sd">        :param delimiter: delimiter used to split the line between file name</span>
<span class="sd">            and start second</span>
<span class="sd">        :type delimiter: str</span>

<span class="sd">        :returns:</span>
<span class="sd">            - **path** (*str*) -- path to the signal file</span>
<span class="sd">            - **start_sec** (*int*) -- start second</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get data file name and starting second</span>
        <span class="k">if</span> <span class="n">delimiter</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">line_split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">start_sec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">start_sec</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">path</span><span class="p">,</span> <span class="n">start_sec</span></div>


<div class="viewcode-block" id="ViSiAnnoT.getDataSigTmp"><a class="viewcode-back" href="../../../APIreference/visiannot/ViSiAnnoT/index.html#visiannot.visiannot.ViSiAnnoT.ViSiAnnoT.getDataSigTmp">[docs]</a>    <span class="k">def</span> <span class="nf">getDataSigTmp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">type_data</span><span class="p">,</span> <span class="n">key_data</span><span class="p">,</span> <span class="n">freq_data</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets signal data after synchronization with video</span>

<span class="sd">        :param path: path to the temporary signal file</span>
<span class="sd">        :type path: str</span>
<span class="sd">        :param type_data: data type (key of the dictionary ``signal_dict``,</span>
<span class="sd">            second positional argument of :class:`.ViSiAnnoT` constructor)</span>
<span class="sd">        :type type_data: str</span>
<span class="sd">        :param key_data: key to access the data (in case of .h5 or .mat file)</span>
<span class="sd">        :type key_data: str</span>
<span class="sd">        :param freq_data: signal frequency</span>
<span class="sd">        :type freq_data: float</span>
<span class="sd">        :param delimiter: delimiter used to split the lines of the temporary</span>
<span class="sd">            signal files</span>
<span class="sd">        :type delimiter: str</span>

<span class="sd">        :returns: signal data synchronized with video</span>
<span class="sd">        :rtype: numpy array</span>

<span class="sd">        :author: Raphael Weber</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># read temporary file</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">ToolsData</span><span class="o">.</span><span class="n">getTxtLines</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># define empty data</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># initialize data list</span>
            <span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">start_sec_prev</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="c1"># loop on temporary file lines</span>
            <span class="k">for</span> <span class="n">ite_line</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="c1"># get data file name and starting second</span>
                <span class="n">file_name</span><span class="p">,</span> <span class="n">start_sec</span> <span class="o">=</span> <span class="n">ViSiAnnoT</span><span class="o">.</span><span class="n">getFileSigTmp</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">)</span>

                <span class="c1"># no data at the beginning</span>
                <span class="k">if</span> <span class="n">file_name</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
                    <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">start_sec</span> <span class="o">*</span> <span class="n">freq_data</span><span class="p">),)))</span>
                    <span class="n">start_sec_prev</span> <span class="o">=</span> <span class="n">start_sec</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># keyword arguments for ToolsData.getDataGeneric</span>
                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>

                    <span class="k">if</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;wav&quot;</span><span class="p">:</span>
                        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;channel_id&quot;</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">ToolsAudio</span><span class="o">.</span><span class="n">convertKeyToChannelId</span><span class="p">(</span><span class="n">key_data</span><span class="p">)</span>

                    <span class="c1"># get data</span>
                    <span class="n">next_data</span> <span class="o">=</span> <span class="n">ToolsData</span><span class="o">.</span><span class="n">getDataGeneric</span><span class="p">(</span>
                        <span class="n">file_name</span><span class="p">,</span> <span class="n">key_data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                    <span class="p">)</span>

                    <span class="c1"># truncate data at the beginning if necessary</span>
                    <span class="k">if</span> <span class="n">ite_line</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># 1D data (constant frequency)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">next_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">start_frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_sec</span> <span class="o">*</span> <span class="n">freq_data</span><span class="p">)</span>
                            <span class="n">next_data</span> <span class="o">=</span> <span class="n">next_data</span><span class="p">[</span><span class="n">start_frame</span><span class="p">:]</span>

                        <span class="c1"># 2D data =&gt; ms timestamp on first axis</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">next_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_sec</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">next_data</span> <span class="o">=</span> <span class="n">next_data</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span>
                            <span class="n">next_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">start_sec</span> <span class="o">*</span> <span class="mi">1000</span>


                    <span class="c1"># truncate data at the end if necessary</span>
                    <span class="k">if</span> <span class="n">ite_line</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># 1D data</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">next_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="c1"># get length of data so far</span>
                            <span class="n">data_length</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="k">for</span> <span class="n">data_tmp</span> <span class="ow">in</span> <span class="n">data_list</span><span class="p">:</span>
                                <span class="n">data_length</span> <span class="o">+=</span> <span class="n">data_tmp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                            <span class="c1"># get the end frame</span>
                            <span class="n">end_frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">freq_data</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">-</span> <span class="n">data_length</span><span class="p">))</span>
                            <span class="n">next_data</span> <span class="o">=</span> <span class="n">next_data</span><span class="p">[:</span><span class="n">end_frame</span><span class="p">]</span>

                        <span class="c1"># 2D data =&gt; ms timestamp on first axis</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">start_sec_prev</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">next_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">-</span> <span class="n">start_sec_prev</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="n">next_data</span> <span class="o">=</span> <span class="n">next_data</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span>
                                <span class="n">next_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">start_sec_prev</span> <span class="o">*</span> <span class="mi">1000</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">next_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="n">next_data</span> <span class="o">=</span> <span class="n">next_data</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span>

                    <span class="n">start_sec_prev</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

                    <span class="c1"># concatenate data</span>
                    <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_data</span><span class="p">)</span>

            <span class="c1"># check if 2D and zero fill at the beginning</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">zero_length</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">freq_data</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">zero_length</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1000</span> <span class="o">/</span> <span class="n">freq_data</span><span class="p">)),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">zero_length</span><span class="p">,))</span>
                        <span class="p">))</span><span class="o">.</span><span class="n">T</span>

            <span class="c1"># get data as a numpy array</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">data_list</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">data</span></div></div>


    <span class="c1"># *********************************************************************** #</span>
    <span class="c1"># End group</span>
    <span class="c1"># *********************************************************************** #</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020-2021, Universit√© Rennes 1

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>